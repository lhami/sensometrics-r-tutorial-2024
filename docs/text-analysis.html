<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Text Analysis | An introduction to text analysis with R for sensory and consumer scientists</title>
  <meta name="description" content="5 Text Analysis | An introduction to text analysis with R for sensory and consumer scientists" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Text Analysis | An introduction to text analysis with R for sensory and consumer scientists" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="jlahne/eurosense-tutorial-2022" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Text Analysis | An introduction to text analysis with R for sensory and consumer scientists" />
  
  
  

<meta name="author" content="Jacob Lahne" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-visualization-basics-with-ggplot2.html"/>
<link rel="next" href="wrap-up-and-further-resources.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction and welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#introductions"><i class="fa fa-check"></i>Introductions</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#jacob-lahne-phd"><i class="fa fa-check"></i>Jacob Lahne, PhD</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#leah-hamilton-phd"><i class="fa fa-check"></i>Leah Hamilton, PhD</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#martha-calvert-ms"><i class="fa fa-check"></i>Martha Calvert, MS</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#todays-agenda"><i class="fa fa-check"></i>Today’s agenda</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-were-going-to-run"><i class="fa fa-check"></i>How we’re going to run</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#recommended-approach-for-livecoding"><i class="fa fa-check"></i>Recommended approach for livecoding</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#dealing-with-errors"><i class="fa fa-check"></i>Dealing with errors</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="a-crash-course-in-r.html"><a href="a-crash-course-in-r.html"><i class="fa fa-check"></i><b>1</b> A crash course in <code>R</code></a>
<ul>
<li class="chapter" data-level="1.1" data-path="a-crash-course-in-r.html"><a href="a-crash-course-in-r.html#r-vs-rstudio"><i class="fa fa-check"></i><b>1.1</b> <code>R</code> vs RStudio</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="a-crash-course-in-r.html"><a href="a-crash-course-in-r.html#what-is-r"><i class="fa fa-check"></i><b>1.1.1</b> What is <code>R</code>?</a></li>
<li class="chapter" data-level="1.1.2" data-path="a-crash-course-in-r.html"><a href="a-crash-course-in-r.html#great-why-are-we-using-rstudio-then"><i class="fa fa-check"></i><b>1.1.2</b> Great, why are we using RStudio then?</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="a-crash-course-in-r.html"><a href="a-crash-course-in-r.html#the-parts-of-rstudio"><i class="fa fa-check"></i><b>1.2</b> The parts of RStudio</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="a-crash-course-in-r.html"><a href="a-crash-course-in-r.html#the-working-directory-and-why-you-should-care"><i class="fa fa-check"></i><b>1.2.1</b> The “working directory” and why you should care</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="a-crash-course-in-r.html"><a href="a-crash-course-in-r.html#extending-r-with-packages"><i class="fa fa-check"></i><b>1.3</b> Extending <code>R</code> with packages</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="a-crash-course-in-r.html"><a href="a-crash-course-in-r.html#installing-packages"><i class="fa fa-check"></i><b>1.3.1</b> Installing packages</a></li>
<li class="chapter" data-level="1.3.2" data-path="a-crash-course-in-r.html"><a href="a-crash-course-in-r.html#loading-packages"><i class="fa fa-check"></i><b>1.3.2</b> Loading packages</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="a-crash-course-in-r.html"><a href="a-crash-course-in-r.html#getting-help"><i class="fa fa-check"></i><b>1.4</b> Getting help</a></li>
<li class="chapter" data-level="1.5" data-path="a-crash-course-in-r.html"><a href="a-crash-course-in-r.html#livecoding-along"><i class="fa fa-check"></i><b>1.5</b> Livecoding along</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="how-to-work-with-r.html"><a href="how-to-work-with-r.html"><i class="fa fa-check"></i><b>2</b> How to work with R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="how-to-work-with-r.html"><a href="how-to-work-with-r.html#doing-math-and-creating-objects-in-r"><i class="fa fa-check"></i><b>2.1</b> Doing math and creating objects in <code>R</code></a></li>
<li class="chapter" data-level="2.2" data-path="how-to-work-with-r.html"><a href="how-to-work-with-r.html#functions-and-their-arguments-in-r"><i class="fa fa-check"></i><b>2.2</b> Functions and their arguments in <code>R</code></a></li>
<li class="chapter" data-level="2.3" data-path="how-to-work-with-r.html"><a href="how-to-work-with-r.html#reading-data-into-r"><i class="fa fa-check"></i><b>2.3</b> Reading data into <code>R</code></a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="how-to-work-with-r.html"><a href="how-to-work-with-r.html#where-the-data-lives"><i class="fa fa-check"></i><b>2.3.1</b> Where the data lives</a></li>
<li class="chapter" data-level="2.3.2" data-path="how-to-work-with-r.html"><a href="how-to-work-with-r.html#what-kind-of-file-are-we-importing"><i class="fa fa-check"></i><b>2.3.2</b> What kind of file are we importing?</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="how-to-work-with-r.html"><a href="how-to-work-with-r.html#data-in-r"><i class="fa fa-check"></i><b>2.4</b> Data in <code>R</code></a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="how-to-work-with-r.html"><a href="how-to-work-with-r.html#subsetting-data"><i class="fa fa-check"></i><b>2.4.1</b> Subsetting data</a></li>
<li class="chapter" data-level="2.4.2" data-path="how-to-work-with-r.html"><a href="how-to-work-with-r.html#complex-vectorslists-data.frame-and-tibble"><i class="fa fa-check"></i><b>2.4.2</b> Complex vectors/lists: <code>data.frame</code> and <code>tibble</code></a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="how-to-work-with-r.html"><a href="how-to-work-with-r.html#subsetting-and-wrangling-data-tables"><i class="fa fa-check"></i><b>2.5</b> Subsetting and wrangling data tables</a></li>
<li class="chapter" data-level="2.6" data-path="how-to-work-with-r.html"><a href="how-to-work-with-r.html#psa-not-knowing-is-normal"><i class="fa fa-check"></i><b>2.6</b> PSA: not-knowing is normal!</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="wrangling-data-with-tidyverse.html"><a href="wrangling-data-with-tidyverse.html"><i class="fa fa-check"></i><b>3</b> Wrangling data with <code>tidyverse</code></a>
<ul>
<li class="chapter" data-level="3.1" data-path="wrangling-data-with-tidyverse.html"><a href="wrangling-data-with-tidyverse.html#subsetting-data-1"><i class="fa fa-check"></i><b>3.1</b> Subsetting data</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="wrangling-data-with-tidyverse.html"><a href="wrangling-data-with-tidyverse.html#select-for-columns"><i class="fa fa-check"></i><b>3.1.1</b> <code>select()</code> for columns</a></li>
<li class="chapter" data-level="3.1.2" data-path="wrangling-data-with-tidyverse.html"><a href="wrangling-data-with-tidyverse.html#filter-for-rows"><i class="fa fa-check"></i><b>3.1.2</b> <code>filter()</code> for rows</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="wrangling-data-with-tidyverse.html"><a href="wrangling-data-with-tidyverse.html#combining-steps-with-the-pipe"><i class="fa fa-check"></i><b>3.2</b> Combining steps with the pipe: <code>%&gt;%</code></a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="wrangling-data-with-tidyverse.html"><a href="wrangling-data-with-tidyverse.html#pipes-require-that-the-lefthand-side-be-a-single-functional-command"><i class="fa fa-check"></i><b>3.2.1</b> Pipes require that the lefthand side be a single functional command</a></li>
<li class="chapter" data-level="3.2.2" data-path="wrangling-data-with-tidyverse.html"><a href="wrangling-data-with-tidyverse.html#pipes-always-pass-the-result-of-the-lefthand-side-to-the-first-argument-of-the-righthand-side"><i class="fa fa-check"></i><b>3.2.2</b> Pipes always pass the result of the lefthand side to the <em>first</em> argument of the righthand side</a></li>
<li class="chapter" data-level="3.2.3" data-path="wrangling-data-with-tidyverse.html"><a href="wrangling-data-with-tidyverse.html#pipes-are-a-pain-to-type"><i class="fa fa-check"></i><b>3.2.3</b> Pipes are a pain to type</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="wrangling-data-with-tidyverse.html"><a href="wrangling-data-with-tidyverse.html#make-new-columns-mutate"><i class="fa fa-check"></i><b>3.3</b> Make new columns: <code>mutate()</code></a></li>
<li class="chapter" data-level="3.4" data-path="wrangling-data-with-tidyverse.html"><a href="wrangling-data-with-tidyverse.html#split-apply-combine-analyses-with-group_by-and-summarize"><i class="fa fa-check"></i><b>3.4</b> Split-apply-combine analyses with <code>group_by()</code> and <code>summarize()</code></a></li>
<li class="chapter" data-level="3.5" data-path="wrangling-data-with-tidyverse.html"><a href="wrangling-data-with-tidyverse.html#utilities-for-data-management"><i class="fa fa-check"></i><b>3.5</b> Utilities for data management</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="wrangling-data-with-tidyverse.html"><a href="wrangling-data-with-tidyverse.html#rename-your-columns"><i class="fa fa-check"></i><b>3.5.1</b> Rename your columns</a></li>
<li class="chapter" data-level="3.5.2" data-path="wrangling-data-with-tidyverse.html"><a href="wrangling-data-with-tidyverse.html#relocate-your-columns"><i class="fa fa-check"></i><b>3.5.2</b> Relocate your columns</a></li>
<li class="chapter" data-level="3.5.3" data-path="wrangling-data-with-tidyverse.html"><a href="wrangling-data-with-tidyverse.html#sort-your-data"><i class="fa fa-check"></i><b>3.5.3</b> Sort your data</a></li>
<li class="chapter" data-level="3.5.4" data-path="wrangling-data-with-tidyverse.html"><a href="wrangling-data-with-tidyverse.html#pivot-tables"><i class="fa fa-check"></i><b>3.5.4</b> Pivot tables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-visualization-basics-with-ggplot2.html"><a href="data-visualization-basics-with-ggplot2.html"><i class="fa fa-check"></i><b>4</b> Data visualization basics with <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="4.1" data-path="data-visualization-basics-with-ggplot2.html"><a href="data-visualization-basics-with-ggplot2.html#your-first-ggplot"><i class="fa fa-check"></i><b>4.1</b> Your first <code>ggplot()</code></a></li>
<li class="chapter" data-level="4.2" data-path="data-visualization-basics-with-ggplot2.html"><a href="data-visualization-basics-with-ggplot2.html#the-aes-function-and-mapping-argument"><i class="fa fa-check"></i><b>4.2</b> The <code>aes()</code> function and <code>mapping =</code> argument</a></li>
<li class="chapter" data-level="4.3" data-path="data-visualization-basics-with-ggplot2.html"><a href="data-visualization-basics-with-ggplot2.html#adding-layers-with-geom_-functions"><i class="fa fa-check"></i><b>4.3</b> Adding layers with <code>geom_*()</code> functions</a></li>
<li class="chapter" data-level="4.4" data-path="data-visualization-basics-with-ggplot2.html"><a href="data-visualization-basics-with-ggplot2.html#arguments-inside-and-outside-of-aes"><i class="fa fa-check"></i><b>4.4</b> Arguments inside and outside of <code>aes()</code></a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="data-visualization-basics-with-ggplot2.html"><a href="data-visualization-basics-with-ggplot2.html#using-theme_-to-change-visual-options-quickly"><i class="fa fa-check"></i><b>4.4.1</b> Using <code>theme_*()</code> to change visual options quickly</a></li>
<li class="chapter" data-level="4.4.2" data-path="data-visualization-basics-with-ggplot2.html"><a href="data-visualization-basics-with-ggplot2.html#changing-aesthetic-elements-with-scale_-functions"><i class="fa fa-check"></i><b>4.4.2</b> Changing aesthetic elements with <code>scale_*()</code> functions</a></li>
<li class="chapter" data-level="4.4.3" data-path="data-visualization-basics-with-ggplot2.html"><a href="data-visualization-basics-with-ggplot2.html#finally-facet_"><i class="fa fa-check"></i><b>4.4.3</b> Finally, <code>facet_*()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="data-visualization-basics-with-ggplot2.html"><a href="data-visualization-basics-with-ggplot2.html#some-further-reading"><i class="fa fa-check"></i><b>4.5</b> Some further reading</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="text-analysis.html"><a href="text-analysis.html"><i class="fa fa-check"></i><b>5</b> Text Analysis</a>
<ul>
<li class="chapter" data-level="5.1" data-path="text-analysis.html"><a href="text-analysis.html#text-analysis-pt.-i-getting-your-text-data"><i class="fa fa-check"></i><b>5.1</b> Text Analysis Pt. I: Getting your text data</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="text-analysis.html"><a href="text-analysis.html#basic-import-and-cleaning-with-text-data"><i class="fa fa-check"></i><b>5.1.1</b> Basic import and cleaning with text data</a></li>
<li class="chapter" data-level="5.1.2" data-path="text-analysis.html"><a href="text-analysis.html#where-is-the-data-in-character-a-tidy-approach."><i class="fa fa-check"></i><b>5.1.2</b> Where is the data in <code>character</code>? A <em>tidy</em> approach.</a></li>
<li class="chapter" data-level="5.1.3" data-path="text-analysis.html"><a href="text-analysis.html#a-quick-note-saving-data"><i class="fa fa-check"></i><b>5.1.3</b> A quick note: saving data</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="text-analysis.html"><a href="text-analysis.html#text-analysis-pt.-ii-basic-text-analysis-approaches-using-tokens"><i class="fa fa-check"></i><b>5.2</b> Text Analysis Pt. II: Basic text analysis approaches using tokens</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="text-analysis.html"><a href="text-analysis.html#word-counts"><i class="fa fa-check"></i><b>5.2.1</b> Word counts</a></li>
<li class="chapter" data-level="5.2.2" data-path="text-analysis.html"><a href="text-analysis.html#term-frequency-inverse-document-frequency-tf-idf"><i class="fa fa-check"></i><b>5.2.2</b> Term Frequency-Inverse Document Frequency (TF-IDF)</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="text-analysis.html"><a href="text-analysis.html#text-analysis-pt.-iii-sentiment-analysis"><i class="fa fa-check"></i><b>5.3</b> Text Analysis Pt. III: Sentiment analysis</a></li>
<li class="chapter" data-level="5.4" data-path="text-analysis.html"><a href="text-analysis.html#text-analysis-pt.-iv-n-gram-models"><i class="fa fa-check"></i><b>5.4</b> Text Analysis Pt. IV: <em>n</em>-gram models</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="wrap-up-and-further-resources.html"><a href="wrap-up-and-further-resources.html"><i class="fa fa-check"></i><b>6</b> Wrap-up and further resources</a>
<ul>
<li class="chapter" data-level="6.1" data-path="wrap-up-and-further-resources.html"><a href="wrap-up-and-further-resources.html#getting-help-1"><i class="fa fa-check"></i><b>6.1</b> Getting help</a></li>
<li class="chapter" data-level="6.2" data-path="wrap-up-and-further-resources.html"><a href="wrap-up-and-further-resources.html#learning-more-with-sensometrics-society"><i class="fa fa-check"></i><b>6.2</b> Learning more with Sensometrics Society</a></li>
<li class="chapter" data-level="6.3" data-path="wrap-up-and-further-resources.html"><a href="wrap-up-and-further-resources.html#further-readingresources"><i class="fa fa-check"></i><b>6.3</b> Further reading/resources</a></li>
<li class="chapter" data-level="6.4" data-path="wrap-up-and-further-resources.html"><a href="wrap-up-and-further-resources.html#questionscomments"><i class="fa fa-check"></i><b>6.4</b> Questions/Comments</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">An introduction to text analysis with R for sensory and consumer scientists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="text-analysis" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">5</span> Text Analysis<a href="text-analysis.html#text-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>At this point we’ve gone over the fundamentals of data wrangling and analysis in R. We really haven’t touched on statistics and modeling, as that is outside the scope of this workshop, but I will be glad to chat about those with anyone outside of the main workshop if you have questions.</p>
<p>Now we’re going to turn to our key focus: text analysis in R. We are going to focus on 3 broad areas:</p>
<ol style="list-style-type: decimal">
<li>Importing, cleaning, and wrangling text data and dealing with <code>character</code> type data.</li>
<li>Basic text modeling using the TF-IDF framework</li>
<li>Application: Sentiment Analysis</li>
</ol>
<p>It’s not a bad idea to restart your R session here. Make sure to save your work, but a clean <code>Environment</code> is great when we’re shifting topics.</p>
<p>You can accomplish this by going to <code>Session &gt; Restart R</code> in the menu.</p>
<p>Then, we want to make sure to re-load our packages and import our data.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="text-analysis.html#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The packages we&#39;re using</span></span>
<span id="cb182-2"><a href="text-analysis.html#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb182-3"><a href="text-analysis.html#cb182-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb182-4"><a href="text-analysis.html#cb182-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-5"><a href="text-analysis.html#cb182-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The dataset</span></span>
<span id="cb182-6"><a href="text-analysis.html#cb182-6" aria-hidden="true" tabindex="-1"></a>beer_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/ba_2002.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 20359 Columns: 14
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (5): reviews, beer_name, brewery_name, style, user_id
## dbl (9): beer_id, brewery_id, abv, appearance, aroma, palate, taste, overall...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div id="text-analysis-pt.-i-getting-your-text-data" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Text Analysis Pt. I: Getting your text data<a href="text-analysis.html#text-analysis-pt.-i-getting-your-text-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There are many sources of text data, which is one of the strengths of this approach. Some quick and obvious examples include:</p>
<ol style="list-style-type: decimal">
<li>Open-comment responses on a survey (sensory study in lab, remote survey, etc)</li>
<li>Comment cards or customer responses</li>
<li>Qualitative data (transcripts from interviews and focus groups)</li>
<li>Compiled/database from previous studies</li>
<li>Scraped data from websites and/or social media</li>
</ol>
<p>The last (#5) is often the most interesting data source, and there are a number of papers in recent years that have discussed the use of this sort of data. I am not going to discuss how to obtain text data in this presentation, because it is its own, rich topic. However, you can <a href="https://github.com/jlahne/text-mining-eurosense-2020">review my presentation and tutorial from Eurosense 2020</a> if you want a quick crash course on web scraping for sensory evaluation.</p>
<div id="basic-import-and-cleaning-with-text-data" class="section level3 hasAnchor" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> Basic import and cleaning with text data<a href="text-analysis.html#basic-import-and-cleaning-with-text-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>So far we’ve focused our attention on the <code>beer_data</code> data set on the various (<code>numeric</code>) rating variables. But the data in the <code>reviews</code> column is clearly more rich.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="text-analysis.html#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb184-2"><a href="text-analysis.html#cb184-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-3"><a href="text-analysis.html#cb184-3" aria-hidden="true" tabindex="-1"></a>reviews_example <span class="ot">&lt;-</span> </span>
<span id="cb184-4"><a href="text-analysis.html#cb184-4" aria-hidden="true" tabindex="-1"></a>  beer_data <span class="sc">%&gt;%</span></span>
<span id="cb184-5"><a href="text-analysis.html#cb184-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb184-6"><a href="text-analysis.html#cb184-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-7"><a href="text-analysis.html#cb184-7" aria-hidden="true" tabindex="-1"></a>reviews_example <span class="sc">%&gt;%</span></span>
<span id="cb184-8"><a href="text-analysis.html#cb184-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(beer_name, reviews) <span class="sc">%&gt;%</span></span>
<span id="cb184-9"><a href="text-analysis.html#cb184-9" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">gt</span>()</span></code></pre></div>
<div id="qlirkacvpr" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#qlirkacvpr .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qlirkacvpr .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qlirkacvpr .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qlirkacvpr .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qlirkacvpr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qlirkacvpr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qlirkacvpr .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qlirkacvpr .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qlirkacvpr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qlirkacvpr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qlirkacvpr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qlirkacvpr .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#qlirkacvpr .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qlirkacvpr .gt_from_md > :first-child {
  margin-top: 0;
}

#qlirkacvpr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qlirkacvpr .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qlirkacvpr .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#qlirkacvpr .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#qlirkacvpr .gt_row_group_first td {
  border-top-width: 2px;
}

#qlirkacvpr .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qlirkacvpr .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#qlirkacvpr .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#qlirkacvpr .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qlirkacvpr .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qlirkacvpr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qlirkacvpr .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qlirkacvpr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qlirkacvpr .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qlirkacvpr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qlirkacvpr .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qlirkacvpr .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qlirkacvpr .gt_left {
  text-align: left;
}

#qlirkacvpr .gt_center {
  text-align: center;
}

#qlirkacvpr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qlirkacvpr .gt_font_normal {
  font-weight: normal;
}

#qlirkacvpr .gt_font_bold {
  font-weight: bold;
}

#qlirkacvpr .gt_font_italic {
  font-style: italic;
}

#qlirkacvpr .gt_super {
  font-size: 65%;
}

#qlirkacvpr .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#qlirkacvpr .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#qlirkacvpr .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#qlirkacvpr .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#qlirkacvpr .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#qlirkacvpr .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">beer_name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">reviews</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">Stoudt's Weizen</td>
<td class="gt_row gt_left">Medium straw and cloudy with thick head and lace. Fresh smelling with slight lemon zest aroma.  Taste is rich and fulfilling with strong lemon flavor. Also notable is the strong, almost overwhealming clove flavor.  Fresh and thirst quenching. Goes great with brats at a German festival.</td></tr>
    <tr><td class="gt_row gt_left">Black Bear Ale</td>
<td class="gt_row gt_left">(3-31-03): Got a new bottle thanks to johnrobe, and unfortunately it was just as bad. This brewery either has ongoing issues or the beer is really supposed to taste this way. I am guessing it is the former. (12-09-02): Acquired via trade. This may be a good beer and I may have gotten a bad bottle but the vinegar aroma ruined this beer. I was given pause before I even had a chance to take a sip because the vinegar aroma is so potent. Plugging my nose and drinking did not help much as the vinegar was prevalent in the flavor as well. I will give this one another shot down the road but I had to pour this one out.</td></tr>
    <tr><td class="gt_row gt_left">Kozel</td>
<td class="gt_row gt_left">A truly good, authentic Pilsner, bordering on great. This is the type of Pilsner Beck's or Labatts (and most North American brewers) wished they could produce. They can't, this brew took time. Brew time and cellar time. The quality of ingredients and process are there for the palate to enjoy on this Pilsner. Soft barley and malt tastes balanced with those heavenly saaz bitters. A great example of Czech pilsen style lagers. This one has a distinguishing quality though. It has everything required of a good Pilsner, flowery hopping evident to the nose and palate, sharp crisp start, tart/malty/grassy in the mouth  dry finish except, this one has no lingering &amp;quot;tinny&amp;quot; taste to the tongue from the saaz hops....probably not pasteurized. I liked this Pilsner very much and that takes something for this fanatical &amp;quot;Pils head&amp;quot;.  The only draw back is the price. $2.85 per 500mil bottle. I was surprised this beer was so fresh tasting, date code was near expired and it sat unrefrigerated on the LCBO (our state liquor monopoly) shelf.  A must try if you like Pilsners.</td></tr>
    <tr><td class="gt_row gt_left">Odell Cutthroat Pale Ale</td>
<td class="gt_row gt_left">This beer pours with a deep thick copper color and a thick foamy white head.   The huge spicy aroma has just a hint of malt.  The smooth medium body initiates an up-front caramel malt sweetness followed by a sharp spicy bitter bite. Very tasty.</td></tr>
    <tr><td class="gt_row gt_left">Pike XXXXX Stout</td>
<td class="gt_row gt_left">Nice pour, deep opaque black with an easy, thick creamy head that clings to the sides of the glass. It's not exactly long-lasting, but it never fully fades (ends up thin cream layer that's too thick for a film, but kind of like a like coat of moss or lichens). The aroma is a little weak, but roasty. The flavor is as strong as it should be but it dominated and unbalanced by too much burned bitterness. A bit of smokiness lingers underneath. The lack of balance makes this less than a joy to drink, but intriguing at the same time.</td></tr>
  </tbody>
  
  
</table>
</div>
<p>
<p>However, this has some classic features of scraped text data–notice the “&amp;quot”, for example–this is <code>HTML</code> placeholder for a quotation mark. Other common problems that you will see with text data include “parsing errors” between different forms of character data–the most common is between <code>ASCII</code> and <code>UTF-8</code> standards. You will of course also encounter errors with typos, and perhaps idiosyncratic formatting characteristic of different text sources: for example, the use of <code>@usernames</code> and <code>#hashtags</code> in Twitter data.</p>
<p>We will use the <code>textclean</code> package to do some basic clean up, but this kind of deep data cleaning may take more steps and will change from project to project.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="text-analysis.html#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(textclean)</span>
<span id="cb185-2"><a href="text-analysis.html#cb185-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-3"><a href="text-analysis.html#cb185-3" aria-hidden="true" tabindex="-1"></a>cleaned_reviews_example <span class="ot">&lt;-</span> </span>
<span id="cb185-4"><a href="text-analysis.html#cb185-4" aria-hidden="true" tabindex="-1"></a>  reviews_example <span class="sc">%&gt;%</span></span>
<span id="cb185-5"><a href="text-analysis.html#cb185-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cleaned_review =</span> reviews <span class="sc">%&gt;%</span></span>
<span id="cb185-6"><a href="text-analysis.html#cb185-6" aria-hidden="true" tabindex="-1"></a>           <span class="co"># Fix some of the HTML placeholders</span></span>
<span id="cb185-7"><a href="text-analysis.html#cb185-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">replace_html</span>(<span class="at">symbol =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb185-8"><a href="text-analysis.html#cb185-8" aria-hidden="true" tabindex="-1"></a>           <span class="co"># Replace sequences of &quot;...&quot; </span></span>
<span id="cb185-9"><a href="text-analysis.html#cb185-9" aria-hidden="true" tabindex="-1"></a>           <span class="fu">replace_incomplete</span>(<span class="at">replacement =</span> <span class="st">&quot; &quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb185-10"><a href="text-analysis.html#cb185-10" aria-hidden="true" tabindex="-1"></a>           <span class="co"># Replace less-common or misformatted HTML</span></span>
<span id="cb185-11"><a href="text-analysis.html#cb185-11" aria-hidden="true" tabindex="-1"></a>           <span class="fu">str_replace_all</span>(<span class="st">&quot;#.{1,4};&quot;</span>, <span class="st">&quot; &quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb185-12"><a href="text-analysis.html#cb185-12" aria-hidden="true" tabindex="-1"></a>           <span class="co"># Replace some common non-A-Z, 1-9 symbols</span></span>
<span id="cb185-13"><a href="text-analysis.html#cb185-13" aria-hidden="true" tabindex="-1"></a>           <span class="fu">replace_symbol</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb185-14"><a href="text-analysis.html#cb185-14" aria-hidden="true" tabindex="-1"></a>           <span class="co"># Remove non-word text like &quot;:)&quot;</span></span>
<span id="cb185-15"><a href="text-analysis.html#cb185-15" aria-hidden="true" tabindex="-1"></a>           <span class="fu">replace_emoticon</span>() <span class="sc">%&gt;%</span></span>
<span id="cb185-16"><a href="text-analysis.html#cb185-16" aria-hidden="true" tabindex="-1"></a>           <span class="co"># Remove numbers from the reviews, as they are not useful</span></span>
<span id="cb185-17"><a href="text-analysis.html#cb185-17" aria-hidden="true" tabindex="-1"></a>           <span class="fu">str_remove_all</span>(<span class="st">&quot;[0-9]&quot;</span>))</span>
<span id="cb185-18"><a href="text-analysis.html#cb185-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-19"><a href="text-analysis.html#cb185-19" aria-hidden="true" tabindex="-1"></a>cleaned_reviews_example <span class="sc">%&gt;%</span></span>
<span id="cb185-20"><a href="text-analysis.html#cb185-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(beer_name, cleaned_review) <span class="sc">%&gt;%</span></span>
<span id="cb185-21"><a href="text-analysis.html#cb185-21" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">gt</span>()</span></code></pre></div>
<div id="swhgavipdk" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#swhgavipdk .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#swhgavipdk .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#swhgavipdk .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#swhgavipdk .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#swhgavipdk .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#swhgavipdk .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#swhgavipdk .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#swhgavipdk .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#swhgavipdk .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#swhgavipdk .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#swhgavipdk .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#swhgavipdk .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#swhgavipdk .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#swhgavipdk .gt_from_md > :first-child {
  margin-top: 0;
}

#swhgavipdk .gt_from_md > :last-child {
  margin-bottom: 0;
}

#swhgavipdk .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#swhgavipdk .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#swhgavipdk .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#swhgavipdk .gt_row_group_first td {
  border-top-width: 2px;
}

#swhgavipdk .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#swhgavipdk .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#swhgavipdk .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#swhgavipdk .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#swhgavipdk .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#swhgavipdk .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#swhgavipdk .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#swhgavipdk .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#swhgavipdk .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#swhgavipdk .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#swhgavipdk .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#swhgavipdk .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#swhgavipdk .gt_left {
  text-align: left;
}

#swhgavipdk .gt_center {
  text-align: center;
}

#swhgavipdk .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#swhgavipdk .gt_font_normal {
  font-weight: normal;
}

#swhgavipdk .gt_font_bold {
  font-weight: bold;
}

#swhgavipdk .gt_font_italic {
  font-style: italic;
}

#swhgavipdk .gt_super {
  font-size: 65%;
}

#swhgavipdk .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#swhgavipdk .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#swhgavipdk .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#swhgavipdk .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#swhgavipdk .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#swhgavipdk .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">beer_name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">cleaned_review</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">Stoudt's Weizen</td>
<td class="gt_row gt_left">Medium straw and cloudy with thick head and lace. Fresh smelling with slight lemon zest aroma. Taste is rich and fulfilling with strong lemon flavor. Also notable is the strong, almost overwhealming clove flavor. Fresh and thirst quenching. Goes great with brats at a German festival.</td></tr>
    <tr><td class="gt_row gt_left">Black Bear Ale</td>
<td class="gt_row gt_left">(--): Got a new bottle thanks to johnrobe, and unfortunately it was just as bad. This brewery either has ongoing issues or the beer is really supposed to taste this way. I am guessing it is the former. (--): Acquired via trade. This may be a good beer and I may have gotten a bad bottle but the vinegar aroma ruined this beer. I was given pause before I even had a chance to take a sip because the vinegar aroma is so potent. Plugging my nose and drinking did not help much as the vinegar was prevalent in the flavor as well. I will give this one another shot down the road but I had to pour this one out.</td></tr>
    <tr><td class="gt_row gt_left">Kozel</td>
<td class="gt_row gt_left">A truly good, authentic Pilsner, bordering on great. This is the type of Pilsner Beck's or Labatts (and most North American brewers) wished they could produce. They can't, this brew took time. Brew time and cellar time. The quality of ingredients and process are there for the palate to enjoy on this Pilsner. Soft barley and malt tastes balanced with those heavenly saaz bitters. A great example of Czech pilsen style lagers. This one has a distinguishing quality though. It has everything required of a good Pilsner, flowery hopping evident to the nose and palate, sharp crisp start, tart/malty/grassy in the mouth dry finish except, this one has no lingering tinny taste to the tongue from the saaz hops probably not pasteurized. I liked this Pilsner very much and that takes something for this fanatical Pils head . The only draw back is the price. dollar . per mil bottle. I was surprised this beer was so fresh tasting, date code was near e tongue sticking out ired and it sat unrefrigerated on the LCBO (our state liquor monopoly) shelf. A must try if you like Pilsners.</td></tr>
    <tr><td class="gt_row gt_left">Odell Cutthroat Pale Ale</td>
<td class="gt_row gt_left">This beer pours with a deep thick copper color and a thick foamy white head. The huge spicy aroma has just a hint of malt. The smooth medium body initiates an up-front caramel malt sweetness followed by a sharp spicy bitter bite. Very tasty.</td></tr>
    <tr><td class="gt_row gt_left">Pike XXXXX Stout</td>
<td class="gt_row gt_left">Nice pour, deep opaque black with an easy, thick creamy head that clings to the sides of the glass. It's not exactly long-lasting, but it never fully fades (ends up thin cream layer that's too thick for a film, but kind of like a like coat of moss or lichens). The aroma is a little weak, but roasty. The flavor is as strong as it should be but it dominated and unbalanced by too much burned bitterness. A bit of smokiness lingers underneath. The lack of balance makes this less than a joy to drink, but intriguing at the same time.</td></tr>
  </tbody>
  
  
</table>
</div>
<p>
<p>This will take slightly longer to run on the full data set, but should improve our overall data quality.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="text-analysis.html#cb186-1" aria-hidden="true" tabindex="-1"></a>beer_data <span class="ot">&lt;-</span> </span>
<span id="cb186-2"><a href="text-analysis.html#cb186-2" aria-hidden="true" tabindex="-1"></a>  beer_data <span class="sc">%&gt;%</span></span>
<span id="cb186-3"><a href="text-analysis.html#cb186-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cleaned_review =</span> reviews <span class="sc">%&gt;%</span></span>
<span id="cb186-4"><a href="text-analysis.html#cb186-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">replace_html</span>(<span class="at">symbol =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb186-5"><a href="text-analysis.html#cb186-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">replace_incomplete</span>(<span class="at">replacement =</span> <span class="st">&quot; &quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb186-6"><a href="text-analysis.html#cb186-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">str_replace_all</span>(<span class="st">&quot;#.{1,4};&quot;</span>, <span class="st">&quot; &quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb186-7"><a href="text-analysis.html#cb186-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">replace_symbol</span>() <span class="sc">%&gt;%</span></span>
<span id="cb186-8"><a href="text-analysis.html#cb186-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">replace_emoticon</span>() <span class="sc">%&gt;%</span></span>
<span id="cb186-9"><a href="text-analysis.html#cb186-9" aria-hidden="true" tabindex="-1"></a>           <span class="fu">str_remove_all</span>(<span class="st">&quot;[0-9]&quot;</span>))</span></code></pre></div>
<p>Again, this is not an exhaustive cleaning step–rather, these are some basic steps that I took based on common parsing errors I observed. Each particular text dataset will come with its own challenges and require a bit of time to develop the cleaning step.</p>
</div>
<div id="where-is-the-data-in-character-a-tidy-approach." class="section level3 hasAnchor" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> Where is the data in <code>character</code>? A <em>tidy</em> approach.<a href="text-analysis.html#where-is-the-data-in-character-a-tidy-approach." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As humans who understand English, we can see that meaning is easily found from these reviews. For example, we can guess that the rating of Black Bear Ale will be a low number (negative), while the rating of Kozel will be much more positive. And, indeed, this is the case:</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="text-analysis.html#cb187-1" aria-hidden="true" tabindex="-1"></a>cleaned_reviews_example <span class="sc">%&gt;%</span> </span>
<span id="cb187-2"><a href="text-analysis.html#cb187-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(beer_name, appearance<span class="sc">:</span>rating)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 7
##   beer_name                appearance aroma palate taste overall rating
##   &lt;chr&gt;                         &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1 Stoudt&#39;s Weizen                 4     3.5    4     4       4     3.88
## 2 Black Bear Ale                  3     1      1     1.5     1.5   1.42
## 3 Kozel                           4     4      4.5   4.5     4     4.25
## 4 Odell Cutthroat Pale Ale        4     4      4     4       4     4   
## 5 Pike XXXXX Stout                4.5   3      4     3.5     2.5   3.29</code></pre>
<p>But what part of the structure of the <code>reviews</code> text actually tells us this? This is a complicated topic that is well beyond the scope of this workshop–we are going to propose a single approach based on <strong>tokenization</strong> that is effective, but is certainly not exhaustive.</p>
<p>If you are interested in a broader view of approaches to text analysis, I recommend the seminal textbook from <a href="https://web.stanford.edu/~jurafsky/slp3/">Jurafsky and Martin, <em>Speech and Language Processing</em></a>, especially chapters 2-6. The draft version is freely available on the web as of the date of this workshop.</p>
<p>In the first half of this workshop we reviewed the <code>tidyverse</code> approach to data, in which we emphasized an approach to data in which:</p>
<blockquote>
<ul>
<li>Each variable is a column</li>
<li>Each observation is a row</li>
<li>Each type of observational unit is a table</li>
</ul>
</blockquote>
<p>This type of approach can be applied to text data <strong>if we can specify a way to standardize the “observations” within the text</strong>. We will be applying and demonstrating the approach defined and promoted by <a href="https://www.tidytextmining.com/index.html">Silge and Robinson in <em>Text Mining with R</em></a>, in which we will focus on the following syllogism to create tidy text data:</p>
<center>
<code>observation == token</code>
</center>
<p>A <strong>token</strong> is a <em>meaningful</em> unit of text, usually but not always a single word, which will be the observation for us. In our example data, let’s identify some possible tokens:</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="text-analysis.html#cb189-1" aria-hidden="true" tabindex="-1"></a>cleaned_reviews_example<span class="sc">$</span>cleaned_review[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] &quot;Medium straw and cloudy with thick head and lace. Fresh smelling with slight lemon zest aroma. Taste is rich and fulfilling with strong lemon flavor. Also notable is the strong, almost overwhealming clove flavor. Fresh and thirst quenching. Goes great with brats at a German festival.&quot;</code></pre>
<p>We will start with only examining single words, also called “<strong>unigrams</strong>” in the linguistics jargon. Thus, <code>Medium</code>, <code>straw</code>, and <code>cloudy</code> are the first tokens in this dataset. We will mostly ignore punctuation and spacing, which means we are giving up some meaning for convenience.</p>
<p>We could figure out how to manually break this up into tokens with enough work, using functions like <code>str_separate()</code>, but happily there are a large set of competing <code>R</code> tools for tokenization, for example:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="text-analysis.html#cb191-1" aria-hidden="true" tabindex="-1"></a>cleaned_reviews_example<span class="sc">$</span>cleaned_review[<span class="dv">1</span>] <span class="sc">%&gt;%</span></span>
<span id="cb191-2"><a href="text-analysis.html#cb191-2" aria-hidden="true" tabindex="-1"></a>  tokenizers<span class="sc">::</span><span class="fu">tokenize_words</span>(<span class="at">simplify =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;medium&quot;        &quot;straw&quot;         &quot;and&quot;           &quot;cloudy&quot;       
##  [5] &quot;with&quot;          &quot;thick&quot;         &quot;head&quot;          &quot;and&quot;          
##  [9] &quot;lace&quot;          &quot;fresh&quot;         &quot;smelling&quot;      &quot;with&quot;         
## [13] &quot;slight&quot;        &quot;lemon&quot;         &quot;zest&quot;          &quot;aroma&quot;        
## [17] &quot;taste&quot;         &quot;is&quot;            &quot;rich&quot;          &quot;and&quot;          
## [21] &quot;fulfilling&quot;    &quot;with&quot;          &quot;strong&quot;        &quot;lemon&quot;        
## [25] &quot;flavor&quot;        &quot;also&quot;          &quot;notable&quot;       &quot;is&quot;           
## [29] &quot;the&quot;           &quot;strong&quot;        &quot;almost&quot;        &quot;overwhealming&quot;
## [33] &quot;clove&quot;         &quot;flavor&quot;        &quot;fresh&quot;         &quot;and&quot;          
## [37] &quot;thirst&quot;        &quot;quenching&quot;     &quot;goes&quot;          &quot;great&quot;        
## [41] &quot;with&quot;          &quot;brats&quot;         &quot;at&quot;            &quot;a&quot;            
## [45] &quot;german&quot;        &quot;festival&quot;</code></pre>
<p>Note that this function also (by default) turns every word into its lowercase version (e.g., <code>Medium</code> becomes <code>medium</code>) and strips out punctuation. This is because, to a program like <code>R</code>, upper- and lowercase versions of the same string are <em>not</em> equivalent. If we have reason to believe preserving this difference is important, we might want to rethink allowing this behavior.</p>
<p>Now, we have 46 observed tokens for our first review in our example dataset. But of course this is not super interesting–we need to apply this kind of transformation to every single one of our ~20,000 reviews. With some fiddling around with <code>mutate()</code> we might be able to come up with a solution, but happily this is where we start using the <code>tidytext</code> package. The <code>unnest_tokens()</code> function built into that package will allow us to transform our text directly into the format we want, with very little effort.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="text-analysis.html#cb193-1" aria-hidden="true" tabindex="-1"></a>beer_data_tokenized <span class="ot">&lt;-</span></span>
<span id="cb193-2"><a href="text-analysis.html#cb193-2" aria-hidden="true" tabindex="-1"></a>  beer_data <span class="sc">%&gt;%</span></span>
<span id="cb193-3"><a href="text-analysis.html#cb193-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We may want to keep track of a unique ID for each review</span></span>
<span id="cb193-4"><a href="text-analysis.html#cb193-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">review_id =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb193-5"><a href="text-analysis.html#cb193-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(<span class="at">output =</span> token,</span>
<span id="cb193-6"><a href="text-analysis.html#cb193-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">input =</span> cleaned_review,</span>
<span id="cb193-7"><a href="text-analysis.html#cb193-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">token =</span> <span class="st">&quot;words&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb193-8"><a href="text-analysis.html#cb193-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Here we do a bit of extra cleaning</span></span>
<span id="cb193-9"><a href="text-analysis.html#cb193-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">token =</span> <span class="fu">str_remove_all</span>(token, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.|_&quot;</span>))</span>
<span id="cb193-10"><a href="text-analysis.html#cb193-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-11"><a href="text-analysis.html#cb193-11" aria-hidden="true" tabindex="-1"></a>beer_data_tokenized <span class="sc">%&gt;%</span></span>
<span id="cb193-12"><a href="text-analysis.html#cb193-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We show just a few of the columns for printing&#39;s sake</span></span>
<span id="cb193-13"><a href="text-analysis.html#cb193-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(beer_name, rating, token)</span></code></pre></div>
<pre><code>## # A tibble: 1,770,136 × 3
##    beer_name           rating token
##    &lt;chr&gt;                &lt;dbl&gt; &lt;chr&gt;
##  1 Caffrey&#39;s Irish Ale   4.46 this 
##  2 Caffrey&#39;s Irish Ale   4.46 is   
##  3 Caffrey&#39;s Irish Ale   4.46 a    
##  4 Caffrey&#39;s Irish Ale   4.46 very 
##  5 Caffrey&#39;s Irish Ale   4.46 good 
##  6 Caffrey&#39;s Irish Ale   4.46 irish
##  7 Caffrey&#39;s Irish Ale   4.46 ale  
##  8 Caffrey&#39;s Irish Ale   4.46 i&#39;m  
##  9 Caffrey&#39;s Irish Ale   4.46 not  
## 10 Caffrey&#39;s Irish Ale   4.46 sure 
## # … with 1,770,126 more rows
## # ℹ Use `print(n = ...)` to see more rows</code></pre>
<p>The <code>unnest_tokens()</code> function actually applies the <code>tokenizers::tokenize_words()</code> function in an efficient, easy way: it takes a column of raw <code>character</code> data and then tokenizes it as specified, outputting a tidy format of 1-token-per-row. Now we have our observations (tokens) each on its own line, ready for further analysis.</p>
<p>In order to make what we’re doing easier to follow, let’s also take a look at our example data.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="text-analysis.html#cb195-1" aria-hidden="true" tabindex="-1"></a>cleaned_reviews_tokenized <span class="ot">&lt;-</span> </span>
<span id="cb195-2"><a href="text-analysis.html#cb195-2" aria-hidden="true" tabindex="-1"></a>  cleaned_reviews_example <span class="sc">%&gt;%</span></span>
<span id="cb195-3"><a href="text-analysis.html#cb195-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(<span class="at">input =</span> cleaned_review, <span class="at">output =</span> token) <span class="sc">%&gt;%</span></span>
<span id="cb195-4"><a href="text-analysis.html#cb195-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Here we do a bit of extra cleaning</span></span>
<span id="cb195-5"><a href="text-analysis.html#cb195-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">token =</span> <span class="fu">str_remove_all</span>(token, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.|_&quot;</span>))</span>
<span id="cb195-6"><a href="text-analysis.html#cb195-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-7"><a href="text-analysis.html#cb195-7" aria-hidden="true" tabindex="-1"></a>cleaned_reviews_tokenized <span class="sc">%&gt;%</span></span>
<span id="cb195-8"><a href="text-analysis.html#cb195-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(beer_name <span class="sc">==</span> <span class="st">&quot;Kozel&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb195-9"><a href="text-analysis.html#cb195-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Let&#39;s select a few variables for printing</span></span>
<span id="cb195-10"><a href="text-analysis.html#cb195-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(beer_name, rating, token)</span></code></pre></div>
<pre><code>## # A tibble: 187 × 3
##    beer_name rating token    
##    &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;    
##  1 Kozel       4.25 a        
##  2 Kozel       4.25 truly    
##  3 Kozel       4.25 good     
##  4 Kozel       4.25 authentic
##  5 Kozel       4.25 pilsner  
##  6 Kozel       4.25 bordering
##  7 Kozel       4.25 on       
##  8 Kozel       4.25 great    
##  9 Kozel       4.25 this     
## 10 Kozel       4.25 is       
## # … with 177 more rows
## # ℹ Use `print(n = ...)` to see more rows</code></pre>
<p>When we use <code>unnest_tokens()</code>, all of the non-text data gets treated as information about each token–so <code>beer_name</code>, <code>rating</code>, etc are duplicated for each token that now has its own row. This will allow us to perform a number of types of text analysis.</p>
</div>
<div id="a-quick-note-saving-data" class="section level3 hasAnchor" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> A quick note: saving data<a href="text-analysis.html#a-quick-note-saving-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We’ve talked about wanting to clear our workspace from <code>R</code> in between sessions to make sure our work and code are reproducible. But at this point we’ve done a lot of work, and we might want to save this work for later. Or, we might want to share our work with others. The <code>tidyverse</code> has a good utility for this when we’re working with data frames and tibbles: the <code>write_csv()</code> function is the opposite of the <code>read_csv()</code> function we’ve gotten comfortable with: it takes a data frame and writes it into a <code>.csv</code> file that is easily shared with others or reloaded in a later session.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="text-analysis.html#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s store our cleaned and tokenized reviews</span></span>
<span id="cb197-2"><a href="text-analysis.html#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(<span class="at">x =</span> beer_data_tokenized, <span class="at">file =</span> <span class="st">&quot;data/tokenized_beer_reviews.csv&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="text-analysis-pt.-ii-basic-text-analysis-approaches-using-tokens" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Text Analysis Pt. II: Basic text analysis approaches using tokens<a href="text-analysis.html#text-analysis-pt.-ii-basic-text-analysis-approaches-using-tokens" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We’ve now seen how to import and clean text, and to transform text data into one useful format for analysis: a tidy table of tokens. (There are certainly other useful formats, but we will not be covering them here.)</p>
<p>Now we get to the actually interesting part. We’re going to tackle some basic but powerful approaches for parsing the meaning of large volumes of text.</p>
<div id="word-counts" class="section level3 hasAnchor" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Word counts<a href="text-analysis.html#word-counts" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A common approach for getting a quick, analytic summary of the nature of the tokens (observations) in our reviews might be to look at the frequency of word use across reviews: this is pretty closely equivalent to a Check-All-That-Apply (CATA) framework: we will look how often each term is used, and will then extend this to categories of interest to our analysis. So, for example, we might have hypotheses like the following that we could hope to investigate using word frequencies:</p>
<ol style="list-style-type: decimal">
<li>Overall, flavor words are the most frequently used words in reviews of beer online.</li>
<li>The frequency of flavor-related words will be different for major categories of beer, like “hop”-related words for IPAs and “chocolate”/“coffee” terms for stouts.</li>
<li>The top flavor words will be qualitatively more positive for reviews associated with the top 10% of ratings, and negative for reviews associated with the bottom 10%.</li>
</ol>
<p>I will not be exploring each of these in this section of the workshop because of time constraints, but hopefully you’ll be able to use the tools I will demonstrate to solve these problems on your own.</p>
<p>Let’s start by combining our tidy data wrangling skills from <code>tidyverse</code> with our newly tidied text data from <code>unnest_tokens()</code> to try to test the first answer.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="text-analysis.html#cb198-1" aria-hidden="true" tabindex="-1"></a>beer_data_tokenized <span class="sc">%&gt;%</span></span>
<span id="cb198-2"><a href="text-analysis.html#cb198-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The count() function gives the number of rows that contain unique values</span></span>
<span id="cb198-3"><a href="text-analysis.html#cb198-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(token) <span class="sc">%&gt;%</span></span>
<span id="cb198-4"><a href="text-analysis.html#cb198-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get the 20 most frequently occurring words</span></span>
<span id="cb198-5"><a href="text-analysis.html#cb198-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> n, <span class="at">n =</span> <span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb198-6"><a href="text-analysis.html#cb198-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Here we do some wrangling for visualization</span></span>
<span id="cb198-7"><a href="text-analysis.html#cb198-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">token =</span> <span class="fu">as.factor</span>(token) <span class="sc">%&gt;%</span> <span class="fu">fct_reorder</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb198-8"><a href="text-analysis.html#cb198-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># let&#39;s visualize this just for fun</span></span>
<span id="cb198-9"><a href="text-analysis.html#cb198-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> token, <span class="at">y =</span> n)) <span class="sc">+</span> </span>
<span id="cb198-10"><a href="text-analysis.html#cb198-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb198-11"><a href="text-analysis.html#cb198-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb198-12"><a href="text-analysis.html#cb198-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb198-13"><a href="text-analysis.html#cb198-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">title =</span> <span class="st">&quot;The 20 most frequent words are not that useful.&quot;</span>)</span></code></pre></div>
<p><img src="5-text-analysis_files/figure-html/what%20are%20the%20most%20frequent%20words%20in%20our%20beer%20data-1.png" width="672" /></p>
<p>Unfortunately for our first hypothesis, we have quickly encountered a common problem in token-based text analysis. The most frequent words in most languages are “helper” words that are necessary for linguistic structure and communication, but are not unique to a particular topic or context. For example, in English the articles <code>a</code>, and <code>the</code> tend to be the most frequent tokens in any text because they are so ubiquitous.</p>
<p>It takes us until the 15th most frequent word, <code>head</code>, to find a word that might have sensory or product implications.</p>
<p>So, in order to find meaning in our text, we need to find some way to look past these terms, whose frequency vastly outnumbers words we are actually interested in.</p>
<div id="stop-words" class="section level4 hasAnchor" number="5.2.1.1">
<h4><span class="header-section-number">5.2.1.1</span> “stop words”<a href="text-analysis.html#stop-words" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In computational linguistics, this kind of word is often called a <strong>stop word</strong>: a word that is functionally important but does not tell us much about the meaning of the text. There are many common lists of such stop words, and in fact the <code>tidytext</code> package provides one such list in the <code>stop_words</code> tibble:</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="text-analysis.html#cb199-1" aria-hidden="true" tabindex="-1"></a>stop_words</span></code></pre></div>
<pre><code>## # A tibble: 1,149 × 2
##    word        lexicon
##    &lt;chr&gt;       &lt;chr&gt;  
##  1 a           SMART  
##  2 a&#39;s         SMART  
##  3 able        SMART  
##  4 about       SMART  
##  5 above       SMART  
##  6 according   SMART  
##  7 accordingly SMART  
##  8 across      SMART  
##  9 actually    SMART  
## 10 after       SMART  
## # … with 1,139 more rows
## # ℹ Use `print(n = ...)` to see more rows</code></pre>
<p>The most basic approach to dealing with stop words is just to outright remove them from our data. This is easy when we’ve got a tidy, one-token-per-row structure.</p>
<p>We could use some version of <code>filter()</code> to remove stop words from our <code>beer_data_tokenized</code> tibble, but this is exactly what the <code>anti_join()</code> function (familiar to those of you who have used SQL) will do: with two tibbles, <code>X</code> and <code>Y</code>, <code>anti_join(X, Y)</code> will remove all rows in <code>X</code> that match rows in <code>Y</code>.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="text-analysis.html#cb201-1" aria-hidden="true" tabindex="-1"></a>beer_data_tokenized <span class="sc">%&gt;%</span></span>
<span id="cb201-2"><a href="text-analysis.html#cb201-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># &quot;by = &quot; tells what column to look for in X and Y</span></span>
<span id="cb201-3"><a href="text-analysis.html#cb201-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(<span class="at">y =</span> stop_words, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;token&quot;</span> <span class="ot">=</span> <span class="st">&quot;word&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb201-4"><a href="text-analysis.html#cb201-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(token) <span class="sc">%&gt;%</span></span>
<span id="cb201-5"><a href="text-analysis.html#cb201-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get the 20 most frequently occurring words</span></span>
<span id="cb201-6"><a href="text-analysis.html#cb201-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> n, <span class="at">n =</span> <span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb201-7"><a href="text-analysis.html#cb201-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Here we do some wrangling for visualization</span></span>
<span id="cb201-8"><a href="text-analysis.html#cb201-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">token =</span> <span class="fu">as.factor</span>(token) <span class="sc">%&gt;%</span> <span class="fu">fct_reorder</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb201-9"><a href="text-analysis.html#cb201-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># let&#39;s visualize this just for fun</span></span>
<span id="cb201-10"><a href="text-analysis.html#cb201-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> token, <span class="at">y =</span> n)) <span class="sc">+</span> </span>
<span id="cb201-11"><a href="text-analysis.html#cb201-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb201-12"><a href="text-analysis.html#cb201-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb201-13"><a href="text-analysis.html#cb201-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb201-14"><a href="text-analysis.html#cb201-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">title =</span> <span class="st">&quot;These tokens are much more relevant.&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;We removed ~1200 stop words.&quot;</span>)</span></code></pre></div>
<p><img src="5-text-analysis_files/figure-html/what%20are%20the%20most%20frequent%20NON%20stop%20words%20in%20beer%20data-1.png" width="672" /></p>
<p>Now we are able to address our very first hypothesis: while the most common term (beer) might be in fact a stop word for this data set, the next 11 top terms all seem to have quite a lot to do with flavor.</p>
<p>We can extend this approach just a bit to provide the start of one answer to our second question: are there different most-used flavor terms for different beer styles? We can start to tackle this by first defining a couple of categories (since there are a lot of different styles in this dataset):</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="text-analysis.html#cb202-1" aria-hidden="true" tabindex="-1"></a>beer_data <span class="sc">%&gt;%</span></span>
<span id="cb202-2"><a href="text-analysis.html#cb202-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(style)</span></code></pre></div>
<pre><code>## # A tibble: 99 × 2
##    style                              n
##    &lt;chr&gt;                          &lt;int&gt;
##  1 Altbier                          186
##  2 American Adjunct Lager           961
##  3 American Amber / Red Ale         653
##  4 American Amber / Red Lager       235
##  5 American Barleywine              187
##  6 American Black Ale                10
##  7 American Blonde Ale              251
##  8 American Brown Ale               166
##  9 American Dark Wheat Ale           11
## 10 American Double / Imperial IPA   151
## # … with 89 more rows
## # ℹ Use `print(n = ...)` to see more rows</code></pre>
<p>Let’s just look at the categories I suggested, plus “lager”. We will do this by using mutate to create a <code>simple_style</code> column:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="text-analysis.html#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, we&#39;ll make sure our approach works</span></span>
<span id="cb204-2"><a href="text-analysis.html#cb204-2" aria-hidden="true" tabindex="-1"></a>beer_data <span class="sc">%&gt;%</span></span>
<span id="cb204-3"><a href="text-analysis.html#cb204-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># First we will set our style to lower case to make matching easier</span></span>
<span id="cb204-4"><a href="text-analysis.html#cb204-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">style =</span> <span class="fu">tolower</span>(style),</span>
<span id="cb204-5"><a href="text-analysis.html#cb204-5" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Then we will use a conditional match to create our new style</span></span>
<span id="cb204-6"><a href="text-analysis.html#cb204-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">simple_style =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(style, <span class="st">&quot;lager&quot;</span>) <span class="sc">~</span> <span class="st">&quot;lager&quot;</span>,</span>
<span id="cb204-7"><a href="text-analysis.html#cb204-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">str_detect</span>(style, <span class="st">&quot;ipa&quot;</span>) <span class="sc">~</span> <span class="st">&quot;IPA&quot;</span>,</span>
<span id="cb204-8"><a href="text-analysis.html#cb204-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">str_detect</span>(style, <span class="st">&quot;stout|porter&quot;</span>) <span class="sc">~</span> <span class="st">&quot;dark&quot;</span>,</span>
<span id="cb204-9"><a href="text-analysis.html#cb204-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;other&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb204-10"><a href="text-analysis.html#cb204-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(simple_style)</span></code></pre></div>
<pre><code>## # A tibble: 4 × 2
##   simple_style     n
##   &lt;chr&gt;        &lt;int&gt;
## 1 dark          2562
## 2 IPA           1274
## 3 lager         3245
## 4 other        13278</code></pre>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="text-analysis.html#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Then we&#39;ll implement the approach for our tokenized data</span></span>
<span id="cb206-2"><a href="text-analysis.html#cb206-2" aria-hidden="true" tabindex="-1"></a>beer_data_tokenized <span class="ot">&lt;-</span> </span>
<span id="cb206-3"><a href="text-analysis.html#cb206-3" aria-hidden="true" tabindex="-1"></a>  beer_data_tokenized <span class="sc">%&gt;%</span></span>
<span id="cb206-4"><a href="text-analysis.html#cb206-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">style =</span> <span class="fu">tolower</span>(style),</span>
<span id="cb206-5"><a href="text-analysis.html#cb206-5" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Then we will use a conditional match to create our new style</span></span>
<span id="cb206-6"><a href="text-analysis.html#cb206-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">simple_style =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(style, <span class="st">&quot;lager&quot;</span>) <span class="sc">~</span> <span class="st">&quot;lager&quot;</span>,</span>
<span id="cb206-7"><a href="text-analysis.html#cb206-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">str_detect</span>(style, <span class="st">&quot;ipa&quot;</span>) <span class="sc">~</span> <span class="st">&quot;IPA&quot;</span>,</span>
<span id="cb206-8"><a href="text-analysis.html#cb206-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">str_detect</span>(style, <span class="st">&quot;stout|porter&quot;</span>) <span class="sc">~</span> <span class="st">&quot;dark&quot;</span>,</span>
<span id="cb206-9"><a href="text-analysis.html#cb206-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;other&quot;</span>)) </span>
<span id="cb206-10"><a href="text-analysis.html#cb206-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-11"><a href="text-analysis.html#cb206-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Finally, we&#39;ll plot the most frequent terms for each simple_style</span></span>
<span id="cb206-12"><a href="text-analysis.html#cb206-12" aria-hidden="true" tabindex="-1"></a>beer_data_tokenized <span class="sc">%&gt;%</span></span>
<span id="cb206-13"><a href="text-analysis.html#cb206-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter out stop words</span></span>
<span id="cb206-14"><a href="text-analysis.html#cb206-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;token&quot;</span> <span class="ot">=</span> <span class="st">&quot;word&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb206-15"><a href="text-analysis.html#cb206-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This time we count tokens WITHIN simple_style</span></span>
<span id="cb206-16"><a href="text-analysis.html#cb206-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(simple_style, token) <span class="sc">%&gt;%</span></span>
<span id="cb206-17"><a href="text-analysis.html#cb206-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Then we will group_by the simple_style</span></span>
<span id="cb206-18"><a href="text-analysis.html#cb206-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(simple_style) <span class="sc">%&gt;%</span></span>
<span id="cb206-19"><a href="text-analysis.html#cb206-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> n, <span class="at">n =</span> <span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb206-20"><a href="text-analysis.html#cb206-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Removing the group_by is necessary for some steps</span></span>
<span id="cb206-21"><a href="text-analysis.html#cb206-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb206-22"><a href="text-analysis.html#cb206-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># A bit of wrangling for plotting</span></span>
<span id="cb206-23"><a href="text-analysis.html#cb206-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">token =</span> <span class="fu">as.factor</span>(token) <span class="sc">%&gt;%</span> <span class="fu">reorder_within</span>(<span class="at">by =</span> n, <span class="at">within =</span> simple_style)) <span class="sc">%&gt;%</span></span>
<span id="cb206-24"><a href="text-analysis.html#cb206-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> token, <span class="at">y =</span> n, <span class="at">fill =</span> simple_style)) <span class="sc">+</span></span>
<span id="cb206-25"><a href="text-analysis.html#cb206-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb206-26"><a href="text-analysis.html#cb206-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>simple_style, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb206-27"><a href="text-analysis.html#cb206-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_reordered</span>() <span class="sc">+</span> </span>
<span id="cb206-28"><a href="text-analysis.html#cb206-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb206-29"><a href="text-analysis.html#cb206-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb206-30"><a href="text-analysis.html#cb206-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">title =</span> <span class="st">&quot;Different (sensory) words tend to be used with different styles.&quot;</span>) <span class="sc">+</span></span>
<span id="cb206-31"><a href="text-analysis.html#cb206-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>))</span></code></pre></div>
<p><img src="5-text-analysis_files/figure-html/what%20words%20are%20associated%20with%20some%20basic%20beer%20styles-1.png" width="672" /></p>
</div>
</div>
<div id="term-frequency-inverse-document-frequency-tf-idf" class="section level3 hasAnchor" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Term Frequency-Inverse Document Frequency (TF-IDF)<a href="text-analysis.html#term-frequency-inverse-document-frequency-tf-idf" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We have seen that removing stop words dramatically increases the quality of our analysis in regards to our specific answers. However, you may be asking yourself: “how do I know what <em>counts as</em> as a stop word?” For example, we see that “beer” is near the top of the list of most frequent tokens for all 4 categories we defined–it is not useful to us–but it is not part of the <code>stop_words</code> tibble. We could, of course, manually remove it (something like <code>filter(token != "beer")</code>). But removing each stop word manually requires us to make <em>a priori</em> judgments about our data, which is not ideal.</p>
<p>One approach that takes a statistical approach to identifying and filtering stop words without the need to define them <em>a priori</em> is the <strong>tf-idf</strong> statistic, which stands for <strong>Term Frequency-Inverse Document Frequency</strong>.</p>
<p>tf-idf requires not just defining tokens, as we have done already using the <code>unnest_tokens()</code> function, but defining “documents” for your specific dataset. The term “document” is somewhat misleading, as it is merely a categorical variable that tells us distinct units in which we want to compare the frequency of our tokens. So in our dataset, <code>simple_style</code> is one such document categorization (representing 4 distinct “documents”); we could also use <code>style</code>, representing 99 distinct categories (“documents”), or any other categorical variable.</p>
<p>The reason that we need to define a “document” variable for our dataset is that td-idf will answer, in general, the following question:</p>
<blockquote>
<p>Given a set of “documents”, what tokens are most frequent <em>within</em> each unique document, but are not common <em>between</em> all documents?</p>
</blockquote>
<p>Defined this way, it is clear that tf-idf has an empirical kinship with all kinds of within/between statistics that we use on a daily basis. In practice, tf-idf is a simple product of two empirical properties of each token in the dataset.</p>
<div id="term-frequency" class="section level4 hasAnchor" number="5.2.2.1">
<h4><span class="header-section-number">5.2.2.1</span> Term Frequency<a href="text-analysis.html#term-frequency" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The <strong>tf</strong> is defined simply for each combination of document and token as the raw count of that token in that document, divided by the sum of raw counts of all tokens in that document.</p>
<center>
<span class="math inline">\(\text{tf}(t, d) = \frac{count_{t}}{\sum_{t \in d}{count_{t}}}\)</span>
</center>
<p>This quantity may be modified (for example, by using smoothing with <span class="math inline">\(\log{(1 + count_{t})}\)</span>). Exact implementations can vary.</p>
</div>
<div id="inverse-document-frequency" class="section level4 hasAnchor" number="5.2.2.2">
<h4><span class="header-section-number">5.2.2.2</span> Inverse Document Frequency<a href="text-analysis.html#inverse-document-frequency" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The <strong>idf</strong> is an empirical estimate of how good a particular token is at distinguishing one “document” from another. It is defined as the logarithm of the total number of documents, divided by the the number of documents that contain the term in question.</p>
<center>
<span class="math inline">\(\text{idf}(t, D) = \log{\frac{N_D}{|\{{d \in D \ : \ t \in d\}|}}}\)</span>
</center>
<p>Where <span class="math inline">\(D\)</span> is the set of documents in the dataset.</p>
<p>Remember that we obtain the tf-idf by <em>multiplying</em> the two terms, which explains the inverse fraction–if we imagined a “tf/df” with division, the definition of the document frequency might be more intuitive but less numerically tractable.</p>
</div>
<div id="applying-tf-idf-in-tidytext" class="section level4 hasAnchor" number="5.2.2.3">
<h4><span class="header-section-number">5.2.2.3</span> Applying tf-idf in <code>tidytext</code><a href="text-analysis.html#applying-tf-idf-in-tidytext" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Overall, the <strong>tf</strong> part of tf-idf is just a scaled what we’ve been doing so far. But the <strong>idf</strong> part provides a measure of validation. For our very frequent terms, that we have been removing as stop words, the tf might be high (they occur a lot) but the idf will be extremely small–all documents use tokens like <code>the</code> and <code>is</code>, so they provide little discriminatory power between documents. Ideally, then, tf-idf will give us a way to drop out stop words without the need to specify them <em>a priori</em>.</p>
<p>Happily, we don’t have to figure out a function for calculating tf-idf ourselves; <code>tidytext</code> provides the <code>bind_tf_idf()</code> function. The only requirement is that we have a data frame that provides a per-“document” count for each token, which we have already done above:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="text-analysis.html#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s first experiment with our &quot;simple_styles&quot;</span></span>
<span id="cb207-2"><a href="text-analysis.html#cb207-2" aria-hidden="true" tabindex="-1"></a>beer_styles_tf_idf <span class="ot">&lt;-</span></span>
<span id="cb207-3"><a href="text-analysis.html#cb207-3" aria-hidden="true" tabindex="-1"></a>  beer_data_tokenized <span class="sc">%&gt;%</span></span>
<span id="cb207-4"><a href="text-analysis.html#cb207-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(simple_style, token) <span class="sc">%&gt;%</span></span>
<span id="cb207-5"><a href="text-analysis.html#cb207-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># And now we can directly add on tf-idf</span></span>
<span id="cb207-6"><a href="text-analysis.html#cb207-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_tf_idf</span>(<span class="at">term =</span> token, <span class="at">document =</span> simple_style, <span class="at">n =</span> n)</span>
<span id="cb207-7"><a href="text-analysis.html#cb207-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-8"><a href="text-analysis.html#cb207-8" aria-hidden="true" tabindex="-1"></a>beer_styles_tf_idf <span class="sc">%&gt;%</span></span>
<span id="cb207-9"><a href="text-analysis.html#cb207-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># let&#39;s look at some stop words</span></span>
<span id="cb207-10"><a href="text-analysis.html#cb207-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(token <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;is&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;the&quot;</span>, <span class="st">&quot;beer&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb207-11"><a href="text-analysis.html#cb207-11" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">gt</span>()</span></code></pre></div>
<div id="finhpmnpfs" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#finhpmnpfs .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#finhpmnpfs .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#finhpmnpfs .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#finhpmnpfs .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#finhpmnpfs .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#finhpmnpfs .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#finhpmnpfs .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#finhpmnpfs .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#finhpmnpfs .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#finhpmnpfs .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#finhpmnpfs .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#finhpmnpfs .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#finhpmnpfs .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#finhpmnpfs .gt_from_md > :first-child {
  margin-top: 0;
}

#finhpmnpfs .gt_from_md > :last-child {
  margin-bottom: 0;
}

#finhpmnpfs .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#finhpmnpfs .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#finhpmnpfs .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#finhpmnpfs .gt_row_group_first td {
  border-top-width: 2px;
}

#finhpmnpfs .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#finhpmnpfs .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#finhpmnpfs .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#finhpmnpfs .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#finhpmnpfs .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#finhpmnpfs .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#finhpmnpfs .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#finhpmnpfs .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#finhpmnpfs .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#finhpmnpfs .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#finhpmnpfs .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#finhpmnpfs .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#finhpmnpfs .gt_left {
  text-align: left;
}

#finhpmnpfs .gt_center {
  text-align: center;
}

#finhpmnpfs .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#finhpmnpfs .gt_font_normal {
  font-weight: normal;
}

#finhpmnpfs .gt_font_bold {
  font-weight: bold;
}

#finhpmnpfs .gt_font_italic {
  font-style: italic;
}

#finhpmnpfs .gt_super {
  font-size: 65%;
}

#finhpmnpfs .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#finhpmnpfs .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#finhpmnpfs .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#finhpmnpfs .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#finhpmnpfs .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#finhpmnpfs .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">simple_style</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">token</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">n</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">tf</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">idf</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">tf_idf</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">dark</td>
<td class="gt_row gt_left">a</td>
<td class="gt_row gt_right">10322</td>
<td class="gt_row gt_right">0.045447741</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td></tr>
    <tr><td class="gt_row gt_left">dark</td>
<td class="gt_row gt_left">beer</td>
<td class="gt_row gt_right">2041</td>
<td class="gt_row gt_right">0.008986518</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td></tr>
    <tr><td class="gt_row gt_left">dark</td>
<td class="gt_row gt_left">is</td>
<td class="gt_row gt_right">4682</td>
<td class="gt_row gt_right">0.020614835</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td></tr>
    <tr><td class="gt_row gt_left">dark</td>
<td class="gt_row gt_left">the</td>
<td class="gt_row gt_right">10610</td>
<td class="gt_row gt_right">0.046715804</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td></tr>
    <tr><td class="gt_row gt_left">IPA</td>
<td class="gt_row gt_left">a</td>
<td class="gt_row gt_right">5285</td>
<td class="gt_row gt_right">0.045000937</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td></tr>
    <tr><td class="gt_row gt_left">IPA</td>
<td class="gt_row gt_left">beer</td>
<td class="gt_row gt_right">1151</td>
<td class="gt_row gt_right">0.009800582</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td></tr>
    <tr><td class="gt_row gt_left">IPA</td>
<td class="gt_row gt_left">is</td>
<td class="gt_row gt_right">2364</td>
<td class="gt_row gt_right">0.020129085</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td></tr>
    <tr><td class="gt_row gt_left">IPA</td>
<td class="gt_row gt_left">the</td>
<td class="gt_row gt_right">5630</td>
<td class="gt_row gt_right">0.047938557</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td></tr>
    <tr><td class="gt_row gt_left">lager</td>
<td class="gt_row gt_left">a</td>
<td class="gt_row gt_right">11868</td>
<td class="gt_row gt_right">0.045791277</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td></tr>
    <tr><td class="gt_row gt_left">lager</td>
<td class="gt_row gt_left">beer</td>
<td class="gt_row gt_right">3773</td>
<td class="gt_row gt_right">0.014557675</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td></tr>
    <tr><td class="gt_row gt_left">lager</td>
<td class="gt_row gt_left">is</td>
<td class="gt_row gt_right">5628</td>
<td class="gt_row gt_right">0.021714974</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td></tr>
    <tr><td class="gt_row gt_left">lager</td>
<td class="gt_row gt_left">the</td>
<td class="gt_row gt_right">10734</td>
<td class="gt_row gt_right">0.041415872</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td></tr>
    <tr><td class="gt_row gt_left">other</td>
<td class="gt_row gt_left">a</td>
<td class="gt_row gt_right">55217</td>
<td class="gt_row gt_right">0.047339678</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td></tr>
    <tr><td class="gt_row gt_left">other</td>
<td class="gt_row gt_left">beer</td>
<td class="gt_row gt_right">12491</td>
<td class="gt_row gt_right">0.010709019</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td></tr>
    <tr><td class="gt_row gt_left">other</td>
<td class="gt_row gt_left">is</td>
<td class="gt_row gt_right">23222</td>
<td class="gt_row gt_right">0.019909122</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td></tr>
    <tr><td class="gt_row gt_left">other</td>
<td class="gt_row gt_left">the</td>
<td class="gt_row gt_right">53203</td>
<td class="gt_row gt_right">0.045612997</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td></tr>
  </tbody>
  
  
</table>
</div>
<p>We can see that, despite very high raw counts for all of these terms, the tf-idf is 0! They do not discriminate across our document categories at all, and so if we start looking for terms with high tf-idf, these will drop out completely.</p>
<p>Let’s take a look at the same visualization we made before with raw counts, but now with tf-idf.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="text-analysis.html#cb208-1" aria-hidden="true" tabindex="-1"></a>beer_styles_tf_idf <span class="sc">%&gt;%</span></span>
<span id="cb208-2"><a href="text-analysis.html#cb208-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We still group by simple_style</span></span>
<span id="cb208-3"><a href="text-analysis.html#cb208-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(simple_style) <span class="sc">%&gt;%</span></span>
<span id="cb208-4"><a href="text-analysis.html#cb208-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Now we want tf-idf, not raw count</span></span>
<span id="cb208-5"><a href="text-analysis.html#cb208-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> tf_idf, <span class="at">n =</span> <span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb208-6"><a href="text-analysis.html#cb208-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb208-7"><a href="text-analysis.html#cb208-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># A bit of wrangling for plotting</span></span>
<span id="cb208-8"><a href="text-analysis.html#cb208-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">token =</span> <span class="fu">as.factor</span>(token) <span class="sc">%&gt;%</span> <span class="fu">reorder_within</span>(<span class="at">by =</span> tf_idf, <span class="at">within =</span> simple_style)) <span class="sc">%&gt;%</span></span>
<span id="cb208-9"><a href="text-analysis.html#cb208-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> token, <span class="at">y =</span> tf_idf, <span class="at">fill =</span> simple_style)) <span class="sc">+</span></span>
<span id="cb208-10"><a href="text-analysis.html#cb208-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb208-11"><a href="text-analysis.html#cb208-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>simple_style, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb208-12"><a href="text-analysis.html#cb208-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_reordered</span>() <span class="sc">+</span> </span>
<span id="cb208-13"><a href="text-analysis.html#cb208-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb208-14"><a href="text-analysis.html#cb208-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb208-15"><a href="text-analysis.html#cb208-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb208-16"><a href="text-analysis.html#cb208-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>, </span>
<span id="cb208-17"><a href="text-analysis.html#cb208-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;With tf-idf we get much more specific terms.&quot;</span>, </span>
<span id="cb208-18"><a href="text-analysis.html#cb208-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;For example, &#39;oatmeal&#39; for stouts, &#39;grapefruity&#39; for IPAs, and so on.&quot;</span>) <span class="sc">+</span></span>
<span id="cb208-19"><a href="text-analysis.html#cb208-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="5-text-analysis_files/figure-html/what%20words%20are%20most%20important%20for%20our%20simple%20styles%20by%20tf-idf-1.png" width="672" /></p>
<p>Thus, tf-idf gives us a flexible, empirical (data-based) model that will surface unique terms for us directly from the data. We can apply the same approach, for example, with a bit of extra wrangling, to see what terms are most associated with beers from the bottom and top deciles by rating (starting to address hypothesis #3):</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="text-analysis.html#cb209-1" aria-hidden="true" tabindex="-1"></a>beer_data_tokenized <span class="sc">%&gt;%</span></span>
<span id="cb209-2"><a href="text-analysis.html#cb209-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># First we get deciles of rating</span></span>
<span id="cb209-3"><a href="text-analysis.html#cb209-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rating_decile =</span> <span class="fu">ntile</span>(rating, <span class="at">n =</span> <span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb209-4"><a href="text-analysis.html#cb209-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># And we&#39;ll select just the top 2 and bottom 2 deciles %&gt;%</span></span>
<span id="cb209-5"><a href="text-analysis.html#cb209-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rating_decile <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">9</span>, <span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb209-6"><a href="text-analysis.html#cb209-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Then we follow the exact same pipeline to get tf-idf</span></span>
<span id="cb209-7"><a href="text-analysis.html#cb209-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(rating_decile, token) <span class="sc">%&gt;%</span></span>
<span id="cb209-8"><a href="text-analysis.html#cb209-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_tf_idf</span>(<span class="at">term =</span> token, <span class="at">document =</span> rating_decile, <span class="at">n =</span> n) <span class="sc">%&gt;%</span></span>
<span id="cb209-9"><a href="text-analysis.html#cb209-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(rating_decile) <span class="sc">%&gt;%</span></span>
<span id="cb209-10"><a href="text-analysis.html#cb209-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Since we have more groups, we&#39;ll just look at 10 tokens</span></span>
<span id="cb209-11"><a href="text-analysis.html#cb209-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> tf_idf, <span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb209-12"><a href="text-analysis.html#cb209-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb209-13"><a href="text-analysis.html#cb209-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># A bit of wrangling for plotting</span></span>
<span id="cb209-14"><a href="text-analysis.html#cb209-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">token =</span> <span class="fu">as.factor</span>(token) <span class="sc">%&gt;%</span> <span class="fu">reorder_within</span>(<span class="at">by =</span> tf_idf, <span class="at">within =</span> rating_decile)) <span class="sc">%&gt;%</span></span>
<span id="cb209-15"><a href="text-analysis.html#cb209-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> token, <span class="at">y =</span> tf_idf, <span class="at">fill =</span> rating_decile)) <span class="sc">+</span></span>
<span id="cb209-16"><a href="text-analysis.html#cb209-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb209-17"><a href="text-analysis.html#cb209-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>rating_decile, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb209-18"><a href="text-analysis.html#cb209-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_reordered</span>() <span class="sc">+</span> </span>
<span id="cb209-19"><a href="text-analysis.html#cb209-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb209-20"><a href="text-analysis.html#cb209-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb209-21"><a href="text-analysis.html#cb209-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb209-22"><a href="text-analysis.html#cb209-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb209-23"><a href="text-analysis.html#cb209-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>, </span>
<span id="cb209-24"><a href="text-analysis.html#cb209-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;When we compare the top 2 and bottom 2 deciles, we see much more affective language.&quot;</span>) <span class="sc">+</span></span>
<span id="cb209-25"><a href="text-analysis.html#cb209-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="5-text-analysis_files/figure-html/what%20words%20are%20associated%20with%20very%20good%20or%20bad%20beers%20by%20tf-idf-1.png" width="672" /></p>
<p>And important point to keep in mind about tf-idf is that it is <strong>data-based</strong>: the numbers are only meaningful within the specific set of tokens and documents. Thus, if I repeat the above pipeline but include all 10 deciles, we will not see the same words (and we will see that the model immediately struggles to find meaningful terms at all). This is because I am no longer calculating with 4 documents, but 10. These statistics are best thought of as descriptive, especially when we are repeatedly using them to explore a dataset.</p>
<p>&lt;img src=“5-text-analysis_files/figure-html/tf-idf is data-based so it will change with”document” choice-1.png” width=“672” /&gt;</p>
<p>We’ve now practiced some basic tools for first wrangling text data into a form with which we can work, and then applying some simple, empirical statistics to start to extract meaning. We’ll discuss <strong>sentiment analysis</strong>, a broad suite of tools that attempts to impute some sort of emotional or affective weight to words, and then produce scores for texts based on these weights.</p>
</div>
</div>
</div>
<div id="text-analysis-pt.-iii-sentiment-analysis" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Text Analysis Pt. III: Sentiment analysis<a href="text-analysis.html#text-analysis-pt.-iii-sentiment-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In recent years, sentiment analysis has gotten a lot of attention in consumer sciences, and it’s one of the topics that has penetrated the furthest into sensory science, because its goals are easily understood in terms of our typical goals: quantifying consumer affective responses to a set of products based on consumption experiences.</p>
<p>In <strong>sentiment analysis</strong>, we attempt to replicate the human inferential process, in which we, as readers, are able to infer–without necessarily being able to explicitly describe <em>how</em> we can tell–the emotional tone of a piece of writing. We understand implicitly whether the author is trying to convey various emotional states, like disgust, appreciation, joy, etc.</p>
<p>In recent years, there have been a number of approaches to sentiment analysis. The current state of the art is to use some kind of machine learning, such as random forests (“shallow learning”) or pre-trained neural networks (“deep learning”; usually convolutional, but sometimes recursive) to learn about a large batch of similar texts and then to process texts of interest. Not to plug myself too much, but we have a poster on such an approach at this conference, which may be of interest to some of you.</p>
<center>
<div class="figure">
<img src="https://imgs.xkcd.com/comics/machine_learning.png" alt="" />
<p class="caption">Machine learning: just throw algebra at the problem! (via <a href="https://xkcd.com/1838">XKCD</a>)</p>
</div>
</center>
<p>While these state-of-the-art approaches are outside of the scope of this workshop, older techniques that use pre-defined dictionaries of sentiment words are easy to implement with a tidy text format, and can be very useful for the basic exploration of text data. These have been used in recent publications to great effect, such as in the recent paper from <a href="https://doi.org/10.1016/j.foodqual.2019.103751">Luc et al. (2020)</a>.</p>
<p>The <code>tidytext</code> package includes the <code>sentiments</code> tibble by default, which is a version of that published by <a href="https://www.cs.uic.edu/~liub/FBS/sentiment-analysis.html">Hu &amp; Liu (2004)</a>.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="text-analysis.html#cb210-1" aria-hidden="true" tabindex="-1"></a>sentiments</span></code></pre></div>
<pre><code>## # A tibble: 6,786 × 2
##    word        sentiment
##    &lt;chr&gt;       &lt;chr&gt;    
##  1 2-faces     negative 
##  2 abnormal    negative 
##  3 abolish     negative 
##  4 abominable  negative 
##  5 abominably  negative 
##  6 abominate   negative 
##  7 abomination negative 
##  8 abort       negative 
##  9 aborted     negative 
## 10 aborts      negative 
## # … with 6,776 more rows
## # ℹ Use `print(n = ...)` to see more rows</code></pre>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="text-analysis.html#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(sentiments, sentiment)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 2
##   sentiment     n
##   &lt;chr&gt;     &lt;int&gt;
## 1 negative   4781
## 2 positive   2005</code></pre>
<p>This is a very commonly used lexicon, which has shown to perform reasonably well on online-review based texts. The <code>tidytext</code> package also gives easy access to a few other lexicons through the <code>get_sentiment()</code> function, which may prompt for downloading some of the lexicons in order to avoid copyright issues. For the purpose of this workshop, we’ll just work with the <code>sentiments</code> tibble, which can also be accessed using <code>get_sentiment("bing")</code>.</p>
<p>The structure of tidy data with tokens makes it very easy to use these dictionary-based sentiment analysis approaches. To do so, all we need to do is use a <code>left_join()</code> function, which is similar to the <code>anti_join()</code> function we used for stop words. In this case, for data tables <code>X</code> and <code>Y</code>, <code>left_join(X, Y)</code> finds rows in <code>Y</code> that match <code>X</code>, and imports all the columns from Y for those matches.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="text-analysis.html#cb214-1" aria-hidden="true" tabindex="-1"></a>beer_sentiments <span class="ot">&lt;-</span> </span>
<span id="cb214-2"><a href="text-analysis.html#cb214-2" aria-hidden="true" tabindex="-1"></a>  beer_data_tokenized <span class="sc">%&gt;%</span></span>
<span id="cb214-3"><a href="text-analysis.html#cb214-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(sentiments, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;token&quot;</span> <span class="ot">=</span> <span class="st">&quot;word&quot;</span>))</span>
<span id="cb214-4"><a href="text-analysis.html#cb214-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-5"><a href="text-analysis.html#cb214-5" aria-hidden="true" tabindex="-1"></a>beer_sentiments <span class="sc">%&gt;%</span></span>
<span id="cb214-6"><a href="text-analysis.html#cb214-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(review_id, beer_name, style, rating, token, sentiment)</span></code></pre></div>
<pre><code>## # A tibble: 1,770,138 × 6
##    review_id beer_name           style         rating token sentiment
##        &lt;int&gt; &lt;chr&gt;               &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    
##  1         1 Caffrey&#39;s Irish Ale irish red ale   4.46 this  &lt;NA&gt;     
##  2         1 Caffrey&#39;s Irish Ale irish red ale   4.46 is    &lt;NA&gt;     
##  3         1 Caffrey&#39;s Irish Ale irish red ale   4.46 a     &lt;NA&gt;     
##  4         1 Caffrey&#39;s Irish Ale irish red ale   4.46 very  &lt;NA&gt;     
##  5         1 Caffrey&#39;s Irish Ale irish red ale   4.46 good  positive 
##  6         1 Caffrey&#39;s Irish Ale irish red ale   4.46 irish &lt;NA&gt;     
##  7         1 Caffrey&#39;s Irish Ale irish red ale   4.46 ale   &lt;NA&gt;     
##  8         1 Caffrey&#39;s Irish Ale irish red ale   4.46 i&#39;m   &lt;NA&gt;     
##  9         1 Caffrey&#39;s Irish Ale irish red ale   4.46 not   &lt;NA&gt;     
## 10         1 Caffrey&#39;s Irish Ale irish red ale   4.46 sure  &lt;NA&gt;     
## # … with 1,770,128 more rows
## # ℹ Use `print(n = ...)` to see more rows</code></pre>
<p>It is immediately apparent how sparse the sentiment lexicons are compared to our actual data. This is one key problem with dictionary-based approaches–we often don’t have application- or domain-specific lexicons, and the lexicons that exist are often not well calibrated to our data.</p>
<p>We can perform a simple <code>count()</code> and <code>group_by()</code> operation to get a rough sentiment score.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="text-analysis.html#cb216-1" aria-hidden="true" tabindex="-1"></a>sentiment_ratings <span class="ot">&lt;-</span> </span>
<span id="cb216-2"><a href="text-analysis.html#cb216-2" aria-hidden="true" tabindex="-1"></a>  beer_sentiments <span class="sc">%&gt;%</span></span>
<span id="cb216-3"><a href="text-analysis.html#cb216-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(review_id, sentiment) <span class="sc">%&gt;%</span></span>
<span id="cb216-4"><a href="text-analysis.html#cb216-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb216-5"><a href="text-analysis.html#cb216-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(review_id) <span class="sc">%&gt;%</span></span>
<span id="cb216-6"><a href="text-analysis.html#cb216-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> sentiment, <span class="at">values_from =</span> n, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb216-7"><a href="text-analysis.html#cb216-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sentiment =</span> positive <span class="sc">-</span> negative)</span>
<span id="cb216-8"><a href="text-analysis.html#cb216-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-9"><a href="text-analysis.html#cb216-9" aria-hidden="true" tabindex="-1"></a>sentiment_ratings</span></code></pre></div>
<pre><code>## # A tibble: 20,328 × 4
## # Groups:   review_id [20,328]
##    review_id negative positive sentiment
##        &lt;int&gt;    &lt;int&gt;    &lt;int&gt;     &lt;int&gt;
##  1         1        1        9         8
##  2         2        3        4         1
##  3         3        1        6         5
##  4         4        1        5         4
##  5         5        0        1         1
##  6         6        1        4         3
##  7         7        1        9         8
##  8         8        1        1         0
##  9         9        0        5         5
## 10        10        3        3         0
## # … with 20,318 more rows
## # ℹ Use `print(n = ...)` to see more rows</code></pre>
<p>In this case, we’re being <em>very</em> rough: we’re not taking into account any of the non-sentiment words, for example. Nevertheless, let’s take a look at what we’ve gotten:</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="text-analysis.html#cb218-1" aria-hidden="true" tabindex="-1"></a>beer_data <span class="sc">%&gt;%</span></span>
<span id="cb218-2"><a href="text-analysis.html#cb218-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">review_id =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb218-3"><a href="text-analysis.html#cb218-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(sentiment_ratings) <span class="sc">%&gt;%</span></span>
<span id="cb218-4"><a href="text-analysis.html#cb218-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sentiment, <span class="at">y =</span> rating)) <span class="sc">+</span> </span>
<span id="cb218-5"><a href="text-analysis.html#cb218-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb218-6"><a href="text-analysis.html#cb218-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="sc">+</span></span>
<span id="cb218-7"><a href="text-analysis.html#cb218-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">11</span>, <span class="dv">30</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb218-8"><a href="text-analysis.html#cb218-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="5-text-analysis_files/figure-html/visualizing%20basic%20sentiment%20against%20rating-1.png" width="672" /></p>
<p>It does appear that there is a positive, probably non-linear relationship between sentiment and rating. We could do some reshaping (normalizing, possibly exponentiating or otherwise transforming the subsequent score) of the sentiment scores to get a better relationship.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="text-analysis.html#cb219-1" aria-hidden="true" tabindex="-1"></a>beer_data <span class="ot">&lt;-</span> </span>
<span id="cb219-2"><a href="text-analysis.html#cb219-2" aria-hidden="true" tabindex="-1"></a>  beer_data <span class="sc">%&gt;%</span></span>
<span id="cb219-3"><a href="text-analysis.html#cb219-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">review_id =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb219-4"><a href="text-analysis.html#cb219-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(sentiment_ratings)</span></code></pre></div>
<pre><code>## Joining, by = &quot;review_id&quot;</code></pre>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="text-analysis.html#cb221-1" aria-hidden="true" tabindex="-1"></a>beer_data <span class="sc">%&gt;%</span></span>
<span id="cb221-2"><a href="text-analysis.html#cb221-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(beer_name, style, rating, sentiment) <span class="sc">%&gt;%</span></span>
<span id="cb221-3"><a href="text-analysis.html#cb221-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(rating, sentiment), <span class="at">names_to =</span> <span class="st">&quot;scale&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb221-4"><a href="text-analysis.html#cb221-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(style, scale) <span class="sc">%&gt;%</span></span>
<span id="cb221-5"><a href="text-analysis.html#cb221-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_value =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb221-6"><a href="text-analysis.html#cb221-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">se_value =</span> <span class="fu">sd</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">n</span>())) <span class="sc">%&gt;%</span></span>
<span id="cb221-7"><a href="text-analysis.html#cb221-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(scale) <span class="sc">%&gt;%</span></span>
<span id="cb221-8"><a href="text-analysis.html#cb221-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> mean_value, <span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb221-9"><a href="text-analysis.html#cb221-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb221-10"><a href="text-analysis.html#cb221-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">style =</span> <span class="fu">factor</span>(style) <span class="sc">%&gt;%</span> <span class="fu">reorder_within</span>(<span class="at">by =</span> mean_value, <span class="at">within =</span> scale)) <span class="sc">%&gt;%</span></span>
<span id="cb221-11"><a href="text-analysis.html#cb221-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> style, <span class="at">y =</span> mean_value, <span class="at">fill =</span> scale)) <span class="sc">+</span> </span>
<span id="cb221-12"><a href="text-analysis.html#cb221-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb221-13"><a href="text-analysis.html#cb221-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_reordered</span>() <span class="sc">+</span></span>
<span id="cb221-14"><a href="text-analysis.html#cb221-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb221-15"><a href="text-analysis.html#cb221-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>scale, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<p><img src="5-text-analysis_files/figure-html/we%20can%20improve%20by%20doing%20some%20normalization-1.png" width="672" /></p>
<p>We can see that we get quite different rankings from sentiment scores and from ratings. It might behoove us to examine some of those mismatches in order to identify where they originate from.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="text-analysis.html#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here are the reviews where the ratings most disagree with the sentiment</span></span>
<span id="cb222-2"><a href="text-analysis.html#cb222-2" aria-hidden="true" tabindex="-1"></a>beer_data <span class="sc">%&gt;%</span></span>
<span id="cb222-3"><a href="text-analysis.html#cb222-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># normalize sentiment and ratings so we can find the largest mismatch</span></span>
<span id="cb222-4"><a href="text-analysis.html#cb222-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rating_norm =</span> rating <span class="sc">/</span> <span class="fu">max</span>(rating, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb222-5"><a href="text-analysis.html#cb222-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">sentiment_norm =</span> sentiment <span class="sc">/</span> <span class="fu">max</span>(sentiment, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb222-6"><a href="text-analysis.html#cb222-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">diff =</span> rating_norm <span class="sc">-</span> sentiment_norm) <span class="sc">%&gt;%</span></span>
<span id="cb222-7"><a href="text-analysis.html#cb222-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(review_id, beer_name, sentiment_norm, rating_norm, diff, cleaned_review) <span class="sc">%&gt;%</span></span>
<span id="cb222-8"><a href="text-analysis.html#cb222-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> diff, <span class="at">n =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb222-9"><a href="text-analysis.html#cb222-9" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">gt</span>()</span></code></pre></div>
<div id="hmfbwrctca" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#hmfbwrctca .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hmfbwrctca .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hmfbwrctca .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hmfbwrctca .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hmfbwrctca .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hmfbwrctca .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hmfbwrctca .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hmfbwrctca .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hmfbwrctca .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hmfbwrctca .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hmfbwrctca .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hmfbwrctca .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#hmfbwrctca .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hmfbwrctca .gt_from_md > :first-child {
  margin-top: 0;
}

#hmfbwrctca .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hmfbwrctca .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hmfbwrctca .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hmfbwrctca .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hmfbwrctca .gt_row_group_first td {
  border-top-width: 2px;
}

#hmfbwrctca .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hmfbwrctca .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hmfbwrctca .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hmfbwrctca .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hmfbwrctca .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hmfbwrctca .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hmfbwrctca .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hmfbwrctca .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hmfbwrctca .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hmfbwrctca .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hmfbwrctca .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hmfbwrctca .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hmfbwrctca .gt_left {
  text-align: left;
}

#hmfbwrctca .gt_center {
  text-align: center;
}

#hmfbwrctca .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hmfbwrctca .gt_font_normal {
  font-weight: normal;
}

#hmfbwrctca .gt_font_bold {
  font-weight: bold;
}

#hmfbwrctca .gt_font_italic {
  font-style: italic;
}

#hmfbwrctca .gt_super {
  font-size: 65%;
}

#hmfbwrctca .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#hmfbwrctca .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#hmfbwrctca .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hmfbwrctca .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#hmfbwrctca .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#hmfbwrctca .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">review_id</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">beer_name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">sentiment_norm</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">rating_norm</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">diff</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">cleaned_review</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right">16065</td>
<td class="gt_row gt_left">Imperial Stout</td>
<td class="gt_row gt_right">-0.3448276</td>
<td class="gt_row gt_right">0.980</td>
<td class="gt_row gt_right">1.324828</td>
<td class="gt_row gt_left">: The color is of black paint. The charcoal-brown head disappears quickly. The smell is of bitterness. Deep, unabiding bitterness of tortured souls. Peets espresso Burning pine forests Sticky, toung-lashing bitterness with a monster grip forces flavors of dried fig, cigar, hazelnut and bitter chocolate (i.e. Valrhona  percent Guanaja ). This is a big, big beer. Not for the timid. Primordial, bowels-of-the-earth type energy is packed in to this now larger,  oz. bottle.</td></tr>
    <tr><td class="gt_row gt_right">15808</td>
<td class="gt_row gt_left">Adam</td>
<td class="gt_row gt_right">-0.3448276</td>
<td class="gt_row gt_right">0.974</td>
<td class="gt_row gt_right">1.318828</td>
<td class="gt_row gt_left">I sampled batch number , I'm gonna put one of these guys away and try it again in a year.Pours syrupy with no head, especially if one follows the directions on the bottle indicating to pour slowly, and I am a sucker for directions on the bottle. Color is incredibly dark brown, completely opaque. Leaves a slight lace as one slowly sips this beer down.Smell is quite complex and sorting it out completely is above the ability of my paltry nose. I would describe it as a sweet and slightly fruity (think figs, raisins). The enigmatic smell seems to call out drink me, and so I listen.Overtones of alcohol do not seem to affect the complex flavor, even though you do feel your BA levels rising as you sip this bad boy down. It seems the smell did not lie, as the taste of the beer is itself sweet and slightly fruity (again I'm thinking of figs and raisins), but there seems to be even more to sort out. There is a bitterness which comes initially and seems to be countered immediately by the sweet flavor described earlier. Finally, at the end of the sip one nutty and coffee flavors resonate and the mild bitterness is back.Overall:Easily the most drinkable double digit ABV beer I have had. Not for beginners, like Stone Arrogant Bastard, this beer just wants to kick your ass. My suggestion is to let it.</td></tr>
  </tbody>
  
  
</table>
</div>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="text-analysis.html#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="co"># And here are the reviews where the sentiment most disagreed with the rating</span></span>
<span id="cb223-2"><a href="text-analysis.html#cb223-2" aria-hidden="true" tabindex="-1"></a>beer_data <span class="sc">%&gt;%</span></span>
<span id="cb223-3"><a href="text-analysis.html#cb223-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># normalize sentiment and ratings so we can find the largest mismatch</span></span>
<span id="cb223-4"><a href="text-analysis.html#cb223-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rating_norm =</span> rating <span class="sc">/</span> <span class="fu">max</span>(rating, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb223-5"><a href="text-analysis.html#cb223-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">sentiment_norm =</span> sentiment <span class="sc">/</span> <span class="fu">max</span>(sentiment, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb223-6"><a href="text-analysis.html#cb223-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">diff =</span> sentiment_norm <span class="sc">-</span> rating_norm) <span class="sc">%&gt;%</span></span>
<span id="cb223-7"><a href="text-analysis.html#cb223-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(review_id, beer_name, sentiment_norm, rating_norm, diff, cleaned_review) <span class="sc">%&gt;%</span></span>
<span id="cb223-8"><a href="text-analysis.html#cb223-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> diff, <span class="at">n =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb223-9"><a href="text-analysis.html#cb223-9" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">gt</span>()</span></code></pre></div>
<div id="wpimoarhdm" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#wpimoarhdm .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wpimoarhdm .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wpimoarhdm .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wpimoarhdm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wpimoarhdm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wpimoarhdm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wpimoarhdm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wpimoarhdm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wpimoarhdm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wpimoarhdm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wpimoarhdm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wpimoarhdm .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#wpimoarhdm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wpimoarhdm .gt_from_md > :first-child {
  margin-top: 0;
}

#wpimoarhdm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wpimoarhdm .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wpimoarhdm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#wpimoarhdm .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#wpimoarhdm .gt_row_group_first td {
  border-top-width: 2px;
}

#wpimoarhdm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wpimoarhdm .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#wpimoarhdm .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#wpimoarhdm .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wpimoarhdm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wpimoarhdm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wpimoarhdm .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wpimoarhdm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wpimoarhdm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wpimoarhdm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wpimoarhdm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wpimoarhdm .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wpimoarhdm .gt_left {
  text-align: left;
}

#wpimoarhdm .gt_center {
  text-align: center;
}

#wpimoarhdm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wpimoarhdm .gt_font_normal {
  font-weight: normal;
}

#wpimoarhdm .gt_font_bold {
  font-weight: bold;
}

#wpimoarhdm .gt_font_italic {
  font-style: italic;
}

#wpimoarhdm .gt_super {
  font-size: 65%;
}

#wpimoarhdm .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#wpimoarhdm .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#wpimoarhdm .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#wpimoarhdm .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#wpimoarhdm .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#wpimoarhdm .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">review_id</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">beer_name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">sentiment_norm</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">rating_norm</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">diff</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">cleaned_review</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right">1477</td>
<td class="gt_row gt_left">Harvest Ale (Limited Edition)</td>
<td class="gt_row gt_right">1.0000000</td>
<td class="gt_row gt_right">0.874</td>
<td class="gt_row gt_right">0.1260000</td>
<td class="gt_row gt_left">Bottle reviews (JAN) Another nice bier to warm up with on a cold, snowy night! Label states st December . Bottling date, or brew date? Anyhow, label also states best before Nov . Oooops, just a bit late. Oh well. Better nate than lever Into the snifter she goes, and it's a dark brown, opaque brew, with a very thin, wispy head congregating only around the rim of the glass. Upon closer inspection, with a little light turned on, I see that the Harvest has a deep ruby hue. Quite nice! Nose is a potent, sweet, rich combo of dark fruit and malty sweetness. Mmmm! Body is more than medium, almost chewy, and silky smooth. Oh yeah! And the flavor is replete with fruity notes, like plum and raisin. Not quite as sweet as the nose suggests, but bulging with dark fruit notes. The high abv is oh-so-well concealed! Don't feel any real warmth, though it's early yet! Along with the fruit is an undercurrent of caramel/toffee sweetness. Real nice! Gotta sip it though; take your time! Tasty bier!! overall: .appearance:  | smell: . | taste: . | mouthfeel: . | drinkability:  *** ***Bottle (FEB) This is a ml bottle of  vintage. Poured a very rich, dark brown color, with little transparency to it. Head is a finely bubbled, tan layer, with more head ringing the outer rim of the snifter. It leaves a fair amount of lace, yet nothing spectacular. Upon taking a whiff I am inundated by raisiny, dark fruit aromas, as well as the unmistakable nose of alcohol. Sweet and rich quite nice! The body is medium to medium-plus, and the biers' passage across the tongue ruffles nary a feather nice and smooth! The taste itself is loaded with creamy, rich, sweet flavors lots of dark fruit and some toffee notes as well. A verrry nice sipping bier, which has aged well since '. Cheers!! (././././. = .)*** ***Cask sample from MAY This beer was sampled at the Boston Beer Summit. The following, courtesy of Matthias Neidhart of B. Unite tongue sticking out It was  vintage , . percent alc./vol. The wooden cask was primed with E.Dupont'scalvados from Normandie,France, prior to its filled with JW Lees Harvest Ale. Lovely mahogany-like color; minimal head and lace, though. Assertive sweet nose, with alcohol quite present. Very nice body, and the smoothness caresses the tongue. Rich, sweet, malty, oaky, nutty flavors with the ever-present alcohol. A wonderful brew! (././././. = .)</td></tr>
    <tr><td class="gt_row gt_right">16339</td>
<td class="gt_row gt_left">XS Old Crustacean</td>
<td class="gt_row gt_right">0.7931034</td>
<td class="gt_row gt_right">0.686</td>
<td class="gt_row gt_right">0.1071034</td>
<td class="gt_row gt_left"> Vintage: This is likely a legend in the making, but it is only at AA ball right now. Like any prospect, it needs time to develop, but many of the skills are already in place.Muddy brown-orange. Frothy, creamy khaki head retains well for a brew of this size.Aroma is big on hops, with pine being the dominate persuasion. Some toffee and chocolate hues are noted as well. Taste is, in a word, raw. Ragged, piney hops seem to pierce through everything. Bitterness is huge. Toastedness and chocolate stuggle for survival. There is a solid carmel/toffee base, but this cannot weather the hop melee. Solvent-like alcohol pops up late, forming an oppresive alliance. Faint dark fruits, and perhaps even tropical fruits linger in the distance, too frightened to approached due to the menacing regime. In a year or two (or five), the malts will begin to win this war, and make this much more balanced. But the hops and alcohol are too aggressive at this point to make any headway. The body is in place, smooth and viscious. Chewable, if somewhat syrup-like.Presently, it is only drinkable to witness the carnage. I'd suggest giving this some time to achieve stability. Psychotic hopheads excluded.With some rounding, this will be in the majors someday. A rough diamond as it is, but capable of aspiring to it's  big brother. The bigger frame (oz vs oz) helps.Thanks, Bighuge. But I should have let this one develop. Hope to find another one to cellar.-- Vintage: I am truely stunned by this amazing beverage where to start? How about the f'king oz's I want oz bottles But at least I have heard the latest batch comes in them.This is my favorite Barleywine. Fantastic integration after  years but this could go strong for several more. Flavor upon flavor. Malt lays down some sweet carmel and (slightly) bready notes. The hops jump on top with some piney and splendedly bitter tones. I also detected some minty hues as well. Sweetness dominates, but in a lovely way. Balance is extraordinary. My lord, is this good.Only drawback (as previously mentioned) is the dollar . for a oz bottle. But still unquestionably worth it. One of the absolute best. Bargain at any price.I am amazed that I can still find this batch, but it is still available in stores in the Madison area. I won't say which ones out of selfishness so you better act fast!!(note to self: pick up more bottles of Ol Crust  tomorrow)</td></tr>
  </tbody>
  
  
</table>
</div>
<p>Interestingly, we see here some evidence that some kind of normalization for review length might be necessary. Let’s take one more look into this area:</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="text-analysis.html#cb224-1" aria-hidden="true" tabindex="-1"></a>beer_data <span class="sc">%&gt;%</span></span>
<span id="cb224-2"><a href="text-analysis.html#cb224-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">word_count =</span> tokenizers<span class="sc">::</span><span class="fu">count_words</span>(cleaned_review)) <span class="sc">%&gt;%</span></span>
<span id="cb224-3"><a href="text-analysis.html#cb224-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(review_id, rating, sentiment, word_count) <span class="sc">%&gt;%</span></span>
<span id="cb224-4"><a href="text-analysis.html#cb224-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(rating, sentiment)) <span class="sc">%&gt;%</span></span>
<span id="cb224-5"><a href="text-analysis.html#cb224-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> word_count, <span class="at">y =</span> value, <span class="at">color =</span> name)) <span class="sc">+</span> </span>
<span id="cb224-6"><a href="text-analysis.html#cb224-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>() <span class="sc">+</span> </span>
<span id="cb224-7"><a href="text-analysis.html#cb224-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span> </span>
<span id="cb224-8"><a href="text-analysis.html#cb224-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb224-9"><a href="text-analysis.html#cb224-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb224-10"><a href="text-analysis.html#cb224-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="5-text-analysis_files/figure-html/review%20length%20seems%20to%20affect%20rating%20and%20sentiment%20to%20different%20degrees-1.png" width="672" /></p>
<p>It appears that both rating and sentiment are positively correlated with word count, but that (unsurprisingly) sentiment is more strongly correlated. Going forward, we might want to consider some way to normalize for word count in our sentiment scores.</p>
</div>
<div id="text-analysis-pt.-iv-n-gram-models" class="section level2 hasAnchor" number="5.4">
<h2><span class="header-section-number">5.4</span> Text Analysis Pt. IV: <em>n</em>-gram models<a href="text-analysis.html#text-analysis-pt.-iv-n-gram-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>An obvious and valid critique of sentiment analysis as implemented above is the focus on single words, or <strong>unigrams</strong>. It is very clear that English (and most languages) have levels of meaning that go beyond the single word, so focusing our analysis on single words as are tokens/observations will lose some (or a lot!) of meaning. It is common in modern text analysis to look at units beyond the single word: bi-, tri-, or <em>n</em>-grams, for example, or so-called “skipgrams” for the popular and powerful <code>word2vec</code> family of algorithms. Tools like convolutional and recursive neural networks will look at larger chunks of texts, combined in different ways.</p>
<p>Let’s take a look at <em>bigrams</em> in our data-set: tokens that are made up of 2 adjacent words. We can get them using the same <code>unnest_tokens()</code> function, but with the request to get <code>token = "ngrams"</code> and the number of tokens set to <code>n = 2</code>.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="text-analysis.html#cb225-1" aria-hidden="true" tabindex="-1"></a>beer_bigrams <span class="ot">&lt;-</span> </span>
<span id="cb225-2"><a href="text-analysis.html#cb225-2" aria-hidden="true" tabindex="-1"></a>  beer_data <span class="sc">%&gt;%</span></span>
<span id="cb225-3"><a href="text-analysis.html#cb225-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(<span class="at">output =</span> bigram, <span class="at">input =</span> cleaned_review, <span class="at">token =</span> <span class="st">&quot;ngrams&quot;</span>, <span class="at">n =</span> <span class="dv">2</span>)</span>
<span id="cb225-4"><a href="text-analysis.html#cb225-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-5"><a href="text-analysis.html#cb225-5" aria-hidden="true" tabindex="-1"></a>beer_bigrams <span class="sc">%&gt;%</span></span>
<span id="cb225-6"><a href="text-analysis.html#cb225-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(review_id <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb225-7"><a href="text-analysis.html#cb225-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(beer_name, bigram)</span></code></pre></div>
<pre><code>## # A tibble: 115 × 2
##    beer_name           bigram    
##    &lt;chr&gt;               &lt;chr&gt;     
##  1 Caffrey&#39;s Irish Ale this is   
##  2 Caffrey&#39;s Irish Ale is a      
##  3 Caffrey&#39;s Irish Ale a very    
##  4 Caffrey&#39;s Irish Ale very good 
##  5 Caffrey&#39;s Irish Ale good irish
##  6 Caffrey&#39;s Irish Ale irish ale 
##  7 Caffrey&#39;s Irish Ale ale i&#39;m   
##  8 Caffrey&#39;s Irish Ale i&#39;m not   
##  9 Caffrey&#39;s Irish Ale not sure  
## 10 Caffrey&#39;s Irish Ale sure if   
## # … with 105 more rows
## # ℹ Use `print(n = ...)` to see more rows</code></pre>
<p>We can see that, in this first review, we already have a bigram with strong semantic content: <code>not sure</code> should tell us that looking only at the unigram <code>sure</code> will give us misleading results.</p>
<p>We can use some more <code>tidyverse</code> helpers to get a better idea of the scale of the problem. The <code>separate()</code> function breaks one character vector into multiple columns, according to whatever separating characters you specify.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="text-analysis.html#cb227-1" aria-hidden="true" tabindex="-1"></a>beer_bigrams <span class="sc">%&gt;%</span></span>
<span id="cb227-2"><a href="text-analysis.html#cb227-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> bigram, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;word1&quot;</span>, <span class="st">&quot;word2&quot;</span>), <span class="at">sep =</span> <span class="st">&quot; &quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb227-3"><a href="text-analysis.html#cb227-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Now we will first filter for bigrams starting with &quot;not&quot;</span></span>
<span id="cb227-4"><a href="text-analysis.html#cb227-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(word1 <span class="sc">==</span> <span class="st">&quot;not&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb227-5"><a href="text-analysis.html#cb227-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># And then we&#39;ll count up the most frequent pairs of negated biterms</span></span>
<span id="cb227-6"><a href="text-analysis.html#cb227-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word1, word2) <span class="sc">%&gt;%</span></span>
<span id="cb227-7"><a href="text-analysis.html#cb227-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>n)</span></code></pre></div>
<pre><code>## # A tibble: 1,298 × 3
##    word1 word2     n
##    &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
##  1 not   a      1511
##  2 not   as      777
##  3 not   much    709
##  4 not   bad     522
##  5 not   too     473
##  6 not   the     376
##  7 not   quite   310
##  8 not   to      283
##  9 not   very    260
## 10 not   sure    251
## # … with 1,288 more rows
## # ℹ Use `print(n = ...)` to see more rows</code></pre>
<p>We can see that the 4th most frequent pair is “not bad”, which means that <code>bad</code>, classified as a <code>negative</code> token in the <code>sentiments</code> tibble, is actually being <em>overcounted</em> as negative in our simple unigram analysis.</p>
<p>We can actually look more closely at this with just a little bit more wrangling:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="text-analysis.html#cb229-1" aria-hidden="true" tabindex="-1"></a>beer_bigrams <span class="sc">%&gt;%</span></span>
<span id="cb229-2"><a href="text-analysis.html#cb229-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> bigram, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;word1&quot;</span>, <span class="st">&quot;word2&quot;</span>), <span class="at">sep =</span> <span class="st">&quot; &quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb229-3"><a href="text-analysis.html#cb229-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(word1 <span class="sc">==</span> <span class="st">&quot;not&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb229-4"><a href="text-analysis.html#cb229-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(sentiments, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;word2&quot;</span> <span class="ot">=</span> <span class="st">&quot;word&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb229-5"><a href="text-analysis.html#cb229-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word1, word2, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 303 × 3
##    word1 word2            n
##    &lt;chr&gt; &lt;chr&gt;        &lt;int&gt;
##  1 not   bad            522
##  2 not   enough         111
##  3 not   overwhelming   104
##  4 not   great           90
##  5 not   worth           73
##  6 not   good            65
##  7 not   like            65
##  8 not   outstanding     46
##  9 not   bitter          44
## 10 not   overbearing     43
## # … with 293 more rows
## # ℹ Use `print(n = ...)` to see more rows</code></pre>
<p>We could use such an approach to try to get a handle on the problem of context in our sentiment analysis, by inverting the sentiment score of any word that is part of a “not bigram”. Of course, such negations can be expressed over entire sentences, or even flavor the entire text (as in the use of sarcasm). There are entire analysis workflows built on this kind of context flow.</p>
<p>For example, the <a href="https://github.com/trinker/sentimentr"><code>sentiment</code> package</a>, which was used in the recent <a href="https://doi.org/10.1016/j.foodqual.2019.103751">Luc et al. (2020) paper on free JAR analysis</a>, takes just such an approach. We can quickly experiment with this package as a demonstration.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="text-analysis.html#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sentimentr)</span>
<span id="cb231-2"><a href="text-analysis.html#cb231-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-3"><a href="text-analysis.html#cb231-3" aria-hidden="true" tabindex="-1"></a>polarity_sentiment <span class="ot">&lt;-</span> </span>
<span id="cb231-4"><a href="text-analysis.html#cb231-4" aria-hidden="true" tabindex="-1"></a>  cleaned_reviews_example <span class="sc">%&gt;%</span> </span>
<span id="cb231-5"><a href="text-analysis.html#cb231-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(beer_name, rating, cleaned_review) <span class="sc">%&gt;%</span></span>
<span id="cb231-6"><a href="text-analysis.html#cb231-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_sentences</span>() <span class="sc">%&gt;%</span></span>
<span id="cb231-7"><a href="text-analysis.html#cb231-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sentiment_by</span>(<span class="at">by =</span> <span class="st">&quot;beer_name&quot;</span>)</span>
<span id="cb231-8"><a href="text-analysis.html#cb231-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-9"><a href="text-analysis.html#cb231-9" aria-hidden="true" tabindex="-1"></a>polarity_sentiment</span></code></pre></div>
<pre><code>##                   beer_name word_count        sd ave_sentiment
## 1:           Black Bear Ale        119 0.2304159   0.007328644
## 2:                    Kozel        187 0.2651420   0.306529868
## 3: Odell Cutthroat Pale Ale         45 0.5829988   0.435923231
## 4:         Pike XXXXX Stout        102 0.2946472  -0.027863992
## 5:          Stoudt&#39;s Weizen         46 0.2081545   0.155677045</code></pre>
<p>We can visualize how the <code>sentimentr</code> algorithm “<em>sees</em>” the sentences by using the <code>highlight(polarity_sentiment)</code> call, but since this outputs <code>HTML</code> I will embed it as an image here.</p>
<center>
<div class="figure">
<img src="img/sentimentr-highlight.png" alt="" />
<p class="caption"><code>sentimentr</code> sentence-based sentiment analysis, using the dictionary-based, polarity-shifting algorithm.</p>
</div>
</center>
<p>As a note, this is only one example of such an algorithm, and it may or may not be the best one. While Luc et al. (2020) found good results, we (again plugging our poster) found that <code>sentimentr</code> didn’t outperform simpler algorithms. However, this may have to do with the set up of lexicons, stop-word lists, etc.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-visualization-basics-with-ggplot2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="wrap-up-and-further-resources.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
